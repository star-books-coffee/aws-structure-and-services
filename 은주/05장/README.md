## Chapter 05. 네트워크 및 콘텐츠 전송 서비스
### IP 주소는 네트워크의 번지

- IP 주소를 바탕으로 위치를 특정하여 그곳에 있는 웹 서버에 접속

### 퍼블릭 IP 주소와 프라이빗 IP 주소

- 라우터 : LAN 과 인터넷 경계에 배치하는 기기
    - 라우터를 통해 LAN 에서 WAN 으로 통신 가능 (네트워크의 현관 역할)   
    ![Untitled](https://file.notion.so/f/f/3db2c1d3-d28f-483a-adc8-ee8abc696878/a4417d1a-ee6e-4799-b254-5e8a7585e179/Untitled.png?id=eeb2fc3a-c7e4-4595-9cae-e1ccd8b03814&table=block&spaceId=3db2c1d3-d28f-483a-adc8-ee8abc696878&expirationTimestamp=1697644800000&signature=PguEtmwD_WdDJ7FgZJNsz42JXxQ7V4bmvvV5pE6l1v4&downloadName=Untitled.png)
- 프라이빗 IP 주소 : LAN 내에서만 식별할 수 있는 IP 주소
    - 10.0.0.0 ~ 10.255.255.255
    - 172.16.0.0 ~ 172.31.255.255
    - 192.168.0.0 ~ 192.168.255.255
    

### CIDR 블록

- IP 주소를 이용해 `네트워크 범위를 정의` 하는 것
- IP 주소 나타내는 문자열 = 네트워크 + 호스트
    - 네트워크 : 네트워크 정의
    - 호스트 : 네트워크 내에서 접속할 수 있는 서버<br>
    ex) 172.31.0.0 / 16<br>
    - 172.31.0.0 와 같이 `호스트 부분이 모두 0인 주소` : `네트워크 주소`
    - 172.31.255.255 와 같이 `호스트 부분이 모두 1인 주소` : `브로드캐스트 주소`<br>
    → 네트워크 주소, 브로드캐스트 주소는 할당이 불가능하므로, 할당 가능한 주소 수는 “네트워크 총 주소 수 - 2” 개
    - / 16 : 서브넷 마스크

### 방화벽

- 보안 위협으로부터 시스템을 지키기 위해 사용하는 것
    - 인터넷을 통해 통신할 필요가 있는 서버는, 특정 사용자나 IP 주소에서만 접근할 수 있게 제한하는 것이 중요 !
    - 따라서 규칙을 설정함
- 하드웨어 형태도 있고, 소프트웨어 형태로 서버에 설치되어 동작하는 것도 있음
- 윈도우 PC 에도 “보안 센터” 설정에서 방화벽 설치되어 동작하고 있음
- AWS 에서는 보안그룹이나 네트워크 ACL 같은 방화별 기능 서비스가 있음

### 라우팅 및 라우팅 테이블

- 어떤 IP 주소를 찾아가기 위해서는 해당 주소까지의 경로를 알아야하는데, 사용자는 알 필요가 없음!
- `라우터` 가 `최적의 경로` 를 찾아서 경로를 설정하고 연결함
- `라우팅 테이블` : 라우터는 소유한 경로 정보를 기반으로, 목적지 IP 주소를 향해 이동해야 하는 네트워크를 결정함
    - 라우터가 소유한 네트워크 지도와 같은 것
    - AWS 에서는 Amazon VPC 의 라우팅 테이블이라는 기능으로 제공함
    - 인터넷이나 각 AWS 서비스에 대해 어떤 엔드포인트를 경유할지와 같은 경로 정보 관리 가능
    

### 도메인 이름과 IP 주소를 연결하는 DNS

- **도메인 이름에는 IP 주소가 연결되어 있어서**, 사용자는 도메인 이름만으로 사이트에 접속 가능
    - DNS (Domain Name System) 이 우리 대신, **도메인 이름에 연결된 IP 주소를 찾아주기** 때문 <br>
    → 이러한 DNS 의 기능을 `이름 해석` 이라고 함
    ![Untitled](https://file.notion.so/f/f/3db2c1d3-d28f-483a-adc8-ee8abc696878/dbc7d0ad-7a38-43ae-b4f0-ddad93024f6c/Untitled.png?id=f72916a6-eff6-4265-b58d-28114ecd5f6c&table=block&spaceId=3db2c1d3-d28f-483a-adc8-ee8abc696878&expirationTimestamp=1697644800000&signature=OC1-_D29qVNR4lpytDh21xej836N_1LWYAxCV2ZKaco&downloadName=Untitled.png)

### 가상 네트워크 Amazon VPC

- **Amazon Virtual Private Cloud (VPC)** : AWS 에서 생성할 수 있는 프라이빗 가상 네트워크 공간
    - 인터넷에 공개하는 **Public VPC** 구축 가능
    - VPN (Virtual Private Network - 가상 사설 네트워크) 등을 이용해 접속하는 **Private VPC** 구축 가능
- VPC 를 만들 때 `CIDR 블록 (IP 주소 범위) 를 지정`하고, **지정한 CIDR 블록 네트워크를 확보**
    - 10.0.0.0/28 → 호스트 주소 2^(32-28) = 2^4= 16개의 IP 주소 사용 가능
    - 호스트 주소는 여유롭게 많이 확보해두는 것이 좋음
    - 호스트 : 네트워크 내에서 접속할 수 있는 서버
- VPC 는 일반적으로 `프라이빗 IP 주소`를 사용 (AWS 의 권고 사항)
    - 임의의 퍼블릭 IP 범위에서 CIDR 블록 지정 가능하지만, 외부 퍼블릭 IP 와 겹치면 통신 불가하므로 기본적으로 프라이빗 IP 주소 공간을 지정하는 것이 좋음
    - 온프레미스나 다른 VPC 등 외부 네트워크와의 접속을 검토한다면, **접속할 네트워크와 VPC 의 CIDR 블록이 중복되지 않게 주의 필요**

### VPC 및 서브넷 생성

- VPC 이름 / CIDR 블록 / IPv6 설정 / 테넌시 (전용 하드웨어 사용 여부)
    - 테넌시 : 라이선스 및 보안 요구 사항으로, 하드웨어 독점하려는 경우에만 독점 옵션 지정
- VPC 만으로는 EC2 같은 자원을 네트워크에 만들 수 없으므로, VPC 안에 더 작은 네트워크 단위인 `서브넷` 을 만들어야 함
    - VPC 내에 서브넷 만들고, 서브넷에 EC2 등을 생성해야 함
    - 서브넷은 하나의 AZ 에 속해야 하며, 여러 AZ에 걸쳐 있을 수 없음
    - 하나의 AZ 에 여러 서브넷은 가능

### VPC 에서 라우팅 정보를 설정해 인터넷과 통신

- `라우팅 테이블` : 네트워크 경로 정보
    - 온프레미스 환경 : **라우터와 같은 네트워크 기기**에 라우팅 테이블 설정
    - AWS : **VPC 에 라우팅 테이블 생성**하여 **각 서브넷에 사용할 라우팅 테이블 지정**
        - 기본 상태에서는 VPC 내의 라우팅 정보만 있어서, 외부로는 통신 불가
        - VPC 외부로 통신하려는 경우, **도착지 (0.0.0.0/0) / 대상 (인터넷 게이트웨이)** 로 라우팅 테이블에 등록하면 `인터넷 게이트웨이` 를 통해 인터넷과 통신 가능
- `인터넷 게이트웨이` : 서브넷 내의 EC2 와 같은 자원이 인터넷과 통신할 수 있게 하기 위한 기능
    - `퍼블릭 서브넷` : 인터넷 게이트웨이로 가는 경로가 설정된 서브넷
    - `프라이빗 서브넷` : 인터넷 게이트웨이를 통해 인터넷과 통신 불가능한 서브넷

### NAT 게이트웨이

- 프라이빗 서브넷에 있는 EC2 같은 자원은, 기본적으로 인터넷과 통신 불가
    - 하지만, VPC 내에서 인터넷과 통신해야 하는 경우가 있음
    - 이 때, NAT 게이트웨이를 사용하는데 인터넷 게이트웨이와 달리 **인터넷 → VPC 로 통신할 수 없는 단방향 통신**이므로 AWS 외부와 더 안전한 통신이 가능
- `NAT` (Network Address Translation) : 프라이빗 IP 주소 → 퍼블릭 IP 주소로 변환하는 것
    - 프라이빗 서브넷의 IP 주소를 NAT 게이트웨이의 퍼블릭 IP 주소로 변환해 인터넷과 통신하게 해줌 !
    - NAT 게이트웨이를 이용하기 위해서는 외부 통신을 수행하는 서브넷의 라우팅 테이블에 경로 정보를 등록 해야 함 / **도착지 (0,0.0.0/0), 대상 (NAT 게이트웨이)**
    

### VPC 접근 제어 및 통신 로그 확인

- 네트워크 접근 제어 목록 (ACL)
    - `서브넷` 단위로 접근 제어 설정 가능
    - 허용 및 거부 설정 가능
    - 상태 비저장 (단일 패킷만 확인하므로 정보 저장 X)
    - 등록된 규칙 번호 순으로 트래픽 허용 및 거부
- 보안 그룹
    - `인스턴스` 단위로 설정 가능
    - 허용만 설정 가능
    - 상태 저장 (패킷, 세션 확인)
    - 등록된 모든 규칙을 평가해 트래픽 허용
- 네트워크 ACL 이나 보안 그룹에서 허용/거부된 통신상황은 `VPC 흐름 로그` 라는 VPC 내의 IP 트래픽 상황을 로그로 저장할 수 있는 기능을 사용해 확인 가능
    - 로그는 AWS 모니터링 서비스 (CloudWatch Logs) 또는 S3 에 저장 가능
    - EC2 와 같은 VPC 자원은 IP 주소마다 `네트워크 인터페이스` (ENI, Elastic Network Interface) 를 가짐
    - 로그는 ENI 별로 출력됨

### VPC 와 외부 네트워크 연결

- `VPC 피어링` : **서로 다른 2개의 VPC** 를 연결해 통신 가능
    - 피어링은 2개의 VPC 간에 수행되기에, 여러 개의 VPC 가 서로 통신하는 경우 각각 VPC 끼리 따로 피어링 구성해야 함
    - 연결된 VPC 의 CIDR 블록은 겹치면 안되므로 주의하자
- `AWS Transit Gateway` : VPC 연결을 하나의 **중앙 허브**에서 관리할 수 있음
    - AWS 네트워크 연결을 중앙에서 관리
    - 많은 VPC 를 사용해야 하면 이걸 사용해서 중앙관리 하는 게 좋음
    

### VPC 와 VPC 외 AWS 서비스 연결하기

- `VPC 엔드포인트` : S3 등 VPC 외부에서 동작하는 AWS 서비스는 보통 인터넷을 거쳐 통신하지만, 이걸 이용하면 **프라이빗 네트워크**로 통신 가능
- `게이트웨이 엔드포인트` : S3 나 DynamoDB 에서 사용하는 VPC 엔드포인트, AWS 서비스와의 통신은 **퍼블릭 IP** 이용
- `인터페이스 엔드포인트` : AWS PrivateLink 기능을 사용해, 서브넷에 서비스 접속용 ENI (네트워크 인터페이스) 를 생성해 프라이빗 IP 로 통신 <br>
→ VPC 외부의 AWS 서비스와 프라이빗 (AWS 내) 통신을 하기 위한 기능

### VPC 와 온프레미스 네트워크 연결하기

- `AWS Site-to-Site VPN` : 온프레미스 환경의 네트워크와 VPC를 VPN 을 연결하는 기능
    - VPN : Virtual Private Network / 가상으로 프라이빗 네트워크 구성해서 통신하는 기술
    - VPN 에 접속하면 **외부 네트워크와 프라이빗 IP 주소로 통신 가능**
- `AWS Client VPN` : 온프레미스 환경의 클라이언트 단말 (PC) 와 VPN 을 연결하는 기능
    - 온프레미스 환경 전체가 아니라, 특정 단말과 비공개로 연결하고 싶은 경우에 사용
- `AWS Direct Connect` : 온프레미스 환경을 AWS 와 전용선으로 연결하는 기능
    - AWS 데이터 센터와 직접 연결하는 것이 Direct Connect 로케이션이라는 기존 연결 지점을 통해 연결함
    - VPN 연결과 비교해 빠르고 고품질의 네트워크를 사용 가능

### 다른 AWS 서비스와의 결합 예시

- AWS 서비스는 실행위치에 따라 3가지 유형으로 나뉨
    - **글로벌 서비스** : 특정 `리전에 의존하지 않고` 실행되는 서비스  ex. CloudFront, IAM
    - **리전 서비스** : `리전 내 VPC 외부에서` 실행되는 서비스  ex. S3, DynamoDB
    - **AZ 서비스** : `VPC 내에서` 실행되는 서비스   ex. EC2, RDS
- 구성 1 : Web + DB + Amazon CloudFront
    - 서버 역할별로 서브넷 생성, `멀티 AZ 대응` (가용성 향상) 을 위해 역할별로 2개의 서브넷 준비
    - VPC 외부로부터 통신을 수신하는 Application Load Balancer `(ALB) 만 퍼블릭 서브넷에 배치`
    - VPC 외부에 `CloudFront 를 이용해 웹 콘텐츠를 캐싱`해 사용자가 콘텐츠에 빠르게 접근할 수 있게 함 (지연시간 latency 최소화 가능)
- 구성 2 : 온프레미스 환경에서 프라이빗 연결
    - Direct Connect 와 Site-to-Site VPN을 모두 사용해 온프레미스 환경과 프라이빗 연결을 하는 구성 (온프레미스 환경 전용 프라이빗 네트워크)
        - VPC와 온프레미스 환경만 통신가능하고, 인터넷과 소통하지 않는 구성

### ELB 란

- Elastic Load Balancing (ELB) : AWS에서 제공하는 로드 밸런서 서비스
    - 응용프로그램으로 트래픽을 로드밸런싱 하는 것
    - **트래픽을 보내는 서버가 멈추지 않고 실행중인지** 정기적으로 확인해 가용성 높일 수 있음
- **부하분산**
    - **트래픽을 다른 AZ에 배치할 수 있어서** (지리적 분산 가능) 재해가 발생해도 가용성 향상
    - ELB 자체가 **부하 상황에 따라 자동 스케일**되므로 사용자는 ELB 성능 저하를 신경쓸 필요가 없음
- **대상 모니터링**
    - **대상 (트래픽의 도착지)** 에 대한 연결과 상태를 감시하고 확인
- 보안기능
    - 보안그룹을 비롯한 AWS 의 기본 보안 서비스 적용 가능
    - SSL/TLS 서버 인증서 설정해서 암호화 통신 수행가능

### ELB 유형

- Application Load Balancer (ALB)
    - http, https 트래픽 부하분산 가능
    - 레이어 7 (응용프로그램 계층) 로 동작하므로 마이크로서비스나 컨테이너 등 다양한 응용프로그램에서 동작 가능
- Network Load Balancer (NLB)
    - 레이어 4 (전송 계층) 로 동작하므로 http/https 외에 tcp, udp, tls의 부하분산도 가능
    - 대규모 트래픽에서도 속도 빠름
 
### Route 53 이란

- **Amazon Route 53** : AWS 가 제공하는 DNS 서비스
    - 도메인 이름 등록하면, 같은 이름의 `호스팅 영역`이 자동으로 생성됨
    - 높은 가용성 : Route 53 서비스 제공하는 기반 시스템이 전 세계에 걸쳐 이중화 되어 있음

### Route 53 의 기능

1. **도메인 등록 기능**
    - 임의의 호스팅 영역을 생성해 `도메인 등록`
    - “xxx.com” 과 같은 임의의 도메인 이름을 Route53 에서 `DNS 레코드` 로 등록 가능
        - DNS 레코드 : DNS 가 관리하는 도메인과 어떤 IP 주소가 연결되어 있는지 기록한 데이터
    - DNS 는 이 DNS 레코드를 기반으로, 질의한 곳의 도메인에 해당하는 IP 주소 반환
2. **도메인 트래픽 라우팅**
    - Route53 에서는 생성한 DNS 레코드별로 `라우팅 정책` 설정 가능
        - 라우팅 : 도메인 이름에 대한 IP 주소를 어떻게 반환하는지
    - `단순 라우팅` : **하나의 도메인에 대해 하나의 IP 주소**만 연결
    - `가중치 기반 라우팅` : 라우팅 대상을 여러 개 등록, 각각에 트래픽을 할당하는 정도를 0~255의 값으로 지정하고 **가중치에 따라 어떤 IP 주소를 반환할 지** 결정
    - `지리적 위치 라우팅` : **조회한 곳의 위치정보**에 따라 어떤 IP 주소를 반환할 지 결정
    - `지연시간 라우팅` : **레이턴시 (데이터 처리 지연 시간) 이 최소인 자원**의 IP 주소를 우선 반환
    - `장애 조치 라우팅` : **일반적으로 프라이머리 IP 로 라우팅하지만, 프라이머리에 장애 발생 시 보조로 라우팅** / 장애발생 여부는 상태 확인 기능으로 판단
    - `다중값 응답 라우팅` : 다중값 응답 설정 시, **Route53 이 질의에 대해 항상 여러 IP 주소를 무작위로 반환**하도록 함
        - 사용자가 여러 서버에 무작위로 할당돼 부하 분산 역할을 함
3. **자원 상태 확인**
    - 상태가 정상인지 판단하는 기준 : 보통 라우팅하는 곳인 웹 서버나 메일 서버에서 반환되는 응답 결과 확인 하는 것
        - 추가적으로 다른 서비스 상태확인 결과 + CloudWatch 경보 확인

### CloudFront 란

- **Amazon CloudFront** : AWS 가 제공하는 콘텐츠 전달 네트워크 (CDN) 서비스
    - 동영상 파일과 같은 대용량 디지털 콘텐츠를 인터넷에서 효율적으로 사용자에게 전달하기 위한 네트워크
- 원본 서버가 데이터 본체를 저장, 데이터의 복사본을 전 세계에 존재하는 캐시 서버에 저장함
- CDN 은 **사용자 위치를 파악해 자동으로 가장 가까운 곳의 캐시 서버로 연결**해 사용자가 빠르게 데이터 취득할 수 있게 함
    - Route53 의 지리적 위치 라우팅과 같은 개념 사용
    - 동영상과 같은 대용량 콘텐츠는 가장 가까운 캐시 서버에서 가져오고, 특정 파일 외에는 원본 서버에서 취득함

### CloudFront 의 장점

1. 대용량 콘텐츠의 빠른 배포
2. 보안 향상
    - CloudFront 적용한 서비스는 자동으로 통신의 SSL/TLS 암호화 수행
    - AWS Shield 라는 무료 DDoS 보호 서비스도 자동 적용되어 공격에 대처 가능
3. 가용성 향상
    - CloudFront 는 전세계에 엣지 로케이션을 가지고 있어서, 대상 데이터 캐시를 저장하므로 원본 서버에 대한 부하가 분산되어 결과적으로 가용성 향상됨
    - 원본 서버에서 장애 발생 시의 동작도 설정 가능

### CloudFront 설정하기

- `배포` : 원본 서버에 배치된 파일에 대한 정보를 취급하는 단위
- **AWS WAF** 를 설정하면, 사용자가 보내는 모든 요청이 CloudFront 의 엣지 로케이션에 도달하기 전에 **AWS WAF 가 보안규칙에 따라 걸러주기 때문에** 안전한 서비스 제공 가능
- ‘오류 페이지’ 설정과 ‘동작’ 설정을 조합해 원본 서버에서 오류 발생 시 특정 에러페이지를 표시하도록 설정 가능

### 전용선 및 VPN

- 전용선 : 거점 간에 `물리적` 으로 연결된 전용의 통신 회선
    - 안전하고 속도 빠르지만 구축 비용이 많이 듦
- VPN : 인터넷을 `가상으로 전용선` 처럼 취급하는 기술
    - 통신 기기 사이에 암호화 수행하고 경로 제어함으로써 각 거점을 전용선으로 연결하고 있는 것처럼 통신 가능
    - Site to Site VPN 과 원격 VPN 으로  분류됨

### AWS Direct Connect

- AWS 와 온프레미스 환경 사이에 전용선을 만드는 서비스로 DX 라고 함
- AWS 가 지정하는 연결 거점까지의 전용선을 사용자가 준비하면, AWS 는 연결 거점부터 사용자 계정환경까지 통신을 연결함

### AWS VPN

- AWS Site-to-Site VPN
    - 두 사이트를 연결하는 VPN 을 구성하기 위한 서비스
- AWS Client VPN
    - 원격 VPN 을 이용해 AWS 에 연결하는 서비스

### AWS Transit Gateway

- VPC 연결을 통합하는 서비스
- 거점 및 VPC 별로 설정한 내용을 `중앙집중식` 으로 관리할 수 있어 간단한 네트워크 구축 가능
    - 거점 간, VPC 간 연결 대상을 한 곳으로 해서 Transit Gateway 에서 경로를 설정

### AWS PrivateLink

- VPC 엔드포인트를 생성하는 서비스
- PrivateLink 를 사용하면 `인터넷을 통하지 않고도` **내부적으로 다른 VPC 와 통신 가능**
    - VPC 끼리의 통신만이라면 VPC 피어링으로도 가능하지만, PrivateLink 는 접속 제어 설정도 가능
    - 인터넷 경유 없이 `VPC 내의 특정 인스턴스만 통신하도록 설정하는 경우` 유용하게 사용됨 (VPC 피어링은 VPC 안의 인스턴스끼리 통신이 돼서, 일부 인스턴스만 통신 허용하는 경우에는 적합하지 않음)

### Amazon API Gateway

- **웹 API 를 생성하는 서비스**로, 데이터 처리 프로그램만을 구현해도 API 서비스 제공 가능
- API Gateway 를 사용하지 않으면, 웹 상에 API 서비스 공개하기 위해 **자체적으로 EC2 와 같은 웹서버를 구축**해서 API 요청을 받아야 함
- API Gateway 를 사용하면, 처리한 요청 수와 데이터 전송량에 대해서만 이용료가 발생하고, 인증기능이 준비되어 있어 에러 발생률이나 처리 시간 감시 가능

### AWS Global Accelerator

- 전 세계에 퍼진 AWS 네트워크망을 이용해 클라이언트가 `AWS 에 더 빠르게 접근할 수 있게` 하는 서비스
- 시스템에 접근하기 위한 고정 IP 주소가 발급되어, 글로벌 트래픽 관리를 간소화할 수 있음

### AWS Ground Station

- 인공위성과의 통신 제공
    - 인공위성 이용 예약과 AWS 가 소유한 기지국과 통신 가능하게 해줌
    - 위성 데이터로부터 지구 관측 데이터를 얻을 수 있음
