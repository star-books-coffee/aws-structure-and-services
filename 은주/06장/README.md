## Chapter 06. 데이터베이스 서비스
### 데이터 불일치를 없애기 위한 ACID 특징

- `원자성` : 트랜잭션은 모두 실행되거나, 실행되지 않아야 함 (ALL OR NOTHING)
- `일관성` : 정해진 데이터베이스 규칙을 만족해야 함 <br>
    ex) 고객 이름이 not null 로 들어가도록 설정했으나, 이름 없는 고객이 추가된다면 일관성을 위반하는 것
- `독립성` : 트랜잭션은 고립되어 있어 연속으로 실행된 것과 동일해야 하고, 이 때 DB 상태도 동일해야 함
- `지속성` : 장애가 있어도 완료된 트랜잭션의 결과는 손실되지 않아야 함, 해당 트랜잭션에 대한 로그가 남아있어야 함

### 관계형 데이터베이스 서비스 RDS

- **Amazon Aurora** : AWS 가 클라우드용으로 구축한 데이터베이스, MySQL 또는 PostgreSQL 과 거의 동일하게 사용할 수 있게 2가지 데이터베이스에 대한 호환성 제공

### DB 성능을 결정하는 인스턴스와 스토리지 유형

- RDS 인스턴스 유형 : 인스턴스의 성능은 인스턴스 크기를 선택해 결정함
- 스토리지 유형 : RDS 에서도 데이터 저장을 위한 스토리 설정 가능

### 가용성 향상을 위한 방법

- 데이터를 처리하는 `프라이머리 인스턴스` 외에 `예비 복제본` 을 다중 AZ 에 배포해 가용성을 높일 수 있음
- `장애조치` : 프라이머리 인스턴스나 AZ 에 장애 발생시 예비 복제본으로 전환해 DB 를 계속 이용하게 함
- 프라이머리 인스턴스에 장애 발생시, RDS 에 할당된 `엔드포인트` 의 목적지가 자동으로 예비 복제본으로 전환됨
- `읽기 전용 레플리카` : 프라이머리 인스턴스에서 복제된 인스턴스
    - 읽기 요청이 늘어나면 **수를 늘리는 스케일아웃 방식**으로 성능 향상
    - 쓰기 성능은 인스턴스 **크기를 변경하는 스케일업**으로 성능 향상
    

### RDS 보안 설정과 백업

- 보안그룹과 네트워크 ACL 에서 설정
- 데이터베이스 엔진 업데이트 : 예비복제본 → 프라이머리 인스턴스 순으로 유지보수 실행
- 데이터 백업 : `자동 백업` 기능이 있어서 지정한 일 수 만큼의 `스냅숏` 자동 유지
    - 백업 윈도우 시간대에 실행되며, 스냅숏 파일은 S3 버킷에 저장되어 내구성이 매우 높음
    - 새 RDS 인스턴스를 생성하는 방식으로 스냅숏 복원 가능
    - 특정 시점 복구 기능을 통해 특정 시간을 지정하고 복원도 가능
 
### AWS 에 최적화된 데이터베이스 : Amazon Aurora

- `DB 클러스터` 라는 단위로 관리되며, 처리를 수행하는 **하나 이상의 DB 인스턴스**와 데이터 관리하는 **클러스터 볼륨**으로 구성됨
    - 클러스터 내의 **인스턴스에서 스토리지가 공유됨**
    - 일반 DB 에서는 EBS 가 인스턴스에 연결되어 **인스턴스별로 데이터가 관리됨**
- 클러스터 볼륨에서는 3개의 AZ 에 2개씩 사본을 작성하여 높은 내결함성을 가짐
    - `쿼럼 모델` 이라는 복제 관리 구조가 사용되어, 쓰기 처리는 4/6, 읽기 처리는 3/6 성공 시 성공이라고 반환

### AWS 에 최적화된 Aurora 기능

- Aurora 복제
    - 1개로 가용성 향상과 읽기 성능 향상을 모두 달성 가능
    - 일반 RDS 는 (가용성 향상을 위한) 예비복제, (읽기 성능 향상을 위한) 읽기 복제를 준비해야 함
    - 쓰기 처리는 클러스터 엔드 포인트에 연결 / 읽기 처리는 `읽기용 엔드포인트` 를 지정해 여러 복제에 분산 처리 가능
- 스토리지 관리는 AWS 가 수행 (스토리지 유형과 용량 지정할 필요가 없음)
- 백업
    - 설정된 보존 기간만큼 지속해서 차분 데이터 취득, 보존 기간 내 임의 시점으로 복원 가능
    - RDS : 스냅숏+변경 로그 형태로 특정 시점으로 복구
    - Aurora : 독자적인 기능과 자동 백업으로 복구
- 다중 리전에 걸친 글로벌 DB
- 2개의 기본 인스턴스가 있는 멀티 마스터 클러스터
- 인스턴스 크기 지정 필요없는 Aurora Serverless
- S3와 연계한 파일 내보내기/가져오기 기능

### 키-값 데이터베이스

- **Amazon DynamoDB** 는 key-value 형 데이터를 저장하는 DB 로, 복잡한 검색은 할 수 없지만 고속 데이터 추출이 가능함
    - key-value 는 데이터 형태로는 자유도가 매우 높지만, RDB 처럼 표 형식이 아니라 집계나 검색이 어려움
- 키-값 형 DB 에서 일련의 데이터를 `레코드` 라고 하며, 레코드의 각 항목 (키, 값) 을 `속성` 이라고 함
    - **레코드가 고유하게 특정할 수 있는 속성 (기본키) 을 가지고 있으면 다른 속성은 어떤 것을 가지고 있어도 상관없음**

### DynamoDB 란

- AWS 가 만든 고속 키-값 데이터베이스
- 키-값 데이터 : 기본적으로 `프라이머리 키` 로만 검색해서 데이터를 가져옴
- 레코드는 `파티션`이라는 보존 영역으로 나뉘어 저장됨
- 서버리스 서비스 ; 테이블 조작 요청은 모두 DynamoDB 가 처리해서 사용자가 서버 관리 안해도 됨
    - EC2, RDS 처럼 사용자가 인스턴스를 소유한다는 개념이 없음 / DynamoDB 라는 하나의 서비스가 요청 처리함

### DynamoDB 보수

- 사용자의 소유물은 데이터 (테이블) 뿐이므로, 테이블 구조 검토나 백업 계획과 같은 데이터 유지보수만 고려하면 됨
- 장애 대비를 위해 DynamoDB 데이터를 이중화하여 저장함 (3개의 AZ에 실시간으로 데이터 복제)
- `특정 시점 복구 (PITR) 기능` : 35일 내 임의의 시점으로 테이블 데이터를 되돌릴 수 있어 데이터 손실이 갑자기 발생해도 대응 가능 / 임의의 시점을 지정해 백업 취득 가능

### DynamoDB 이용 예

- 모바일, 웹, 게임, 광고, IoT 같이 데이터 교환이 매우 많고 사용자에게 `빠른 응답`이 필요한 응용프로그램에 이용됨
    - IoT 기술을 활용한 차량 위치추적 시스템
    - 게임 순위 시스템
    - 웹 광고의 클릭 수 관리
- 실시간 업데이트와 확인이 필요한 시스템에 사용하기 좋음

### 분석용 데이터베이스 RedShift

- **Amazon RedShift** : 데이터 분석을 위한 데이터 웨어하우스 서비스
    - 데이터 웨어하우스 : 짐을 창고에 쌓아두듯이 데이터를 쌓아두는 역할을 하는 것
- 다른 리전에 있는 대량의 S3 나 RDS 데이터를 RedShift 로 가져와 SQL 이나 BI 도구를 이용해 분석할 수 있게 해줌
- 많은 분석 데이터베이스는 `열 지향 스토리지` 구조로 되어있는데, 이유는 데이터를 분석하는 경우 (평균 산출 등) 열 단위로 처리하는 경우가 많음
- 데이터 조작을 위해 SQL 을 사용함
    - SQL 연결을 받아들이는 `리더 노드`
    - SQL 문을 실행하는 `컴퓨터 노드` : 여러 개 존재하므로 처리를 분산해 고속 실행
- RA3 (노드 유형) : **캐시 데이터**를 컴퓨터 노드로 가져오고 실제 데이터는 S3 에 보관
- 분석 및 데이터 읽기에 특화된 데이터베이스이므로 INSERT, UPDATE 문 실행해 데이터를 하나씩 삽입하는 것은 권장 X
    - 대신 COPY 명령을 이용해 S3 버킷에서 여러 개 텍스트 데이터를 병렬 업로드 하는 것을 추천

### AWS Database Migration Service

- 데이터베이스를 마이그레이션하기 위한 서비스
    - 단순히 데이터를 옮기는 것 뿐만 아니라, `데이터 형식`을 맞춰 옮겨주거나 마이그레이션 도중 발생한 `원본 데이터 변경 내용도 추적`해 반영 가능

### AWS Schema Conversion Tool

- 데이터 자체를 옮기기 전에 먼저 `스키마를 변환`하는 작업을 해줌 (기존 데이터베이스 데이터를 새로운 데이터베이스 데이터 형식에 맞게 변환)
- 스키마 변환에 대한 평가 보고서도 확인 가능
    - 자동 마이그레이션 불가능하다거나, 기존 DB 에서는 지원했지만 새로운 DB 에서는 지원하지 못하는 기능과 같이 마이그레이션 이후 발생할 수 있는 문제점을 미리 확인할 수 있음
- 예시) oracle → mysql 로 마이그레이션
    1. SCT 로 새로운 데이터베이스에 저장하기 위한 스키마 생성
    2. 필요에 따라 스키마 수동 수정
    3. 생성한 스키마에 DMS 로 데이터 입력
    4. DMS 로 데이터가 완전히 마이그레이션 됐는지 검증

### Amazon ElastiCache

- 인메모리 데이터 스토어 서비스로, 주기억장치 (메모리) 에 데이터를 저장해서, 보조 기억장치 (SSD, HDD) 에 저장하는 것보다 **고속으로 데이터 읽고 쓸 수 있게 해줌**
- 읽기/쓰기 속도를 올리기 위해 메모리를 활용하는 `캐싱` 과 동일하게 사용되기 때문에 “인메모리 캐싱”이라고도 함
- 메모리에 저장되므로 속도가 빠르지만, 시스템 정지 시 메모리에 저장된 데이터가 모두 삭제됨 / 따라서 필요한 데이터는 따로 저장해두어야 함
- Redis 나 Memcached 와 호환됨 (ElastiCache for Memcached / ElastiCache for Redis)

### Amazon MemoryDB for Redis

- ElastiCache 의 단점을 해결하기 위해 나온, **데이터의 지속성을 확보하면서도 빠른 읽기/쓰기가 가능**한 서비스
- Redis 는 메모리 뿐만 아니라 보조 저장 장치에도 데이터를 저장하므로, 메모리의 데이터가 사라져도 복구 가능
- 읽기 속도는 비슷하나, 쓰기 처리는 ElastiCache 보다는 느림

### Amazon DocumentDB

- `문서 지향 데이터베이스` 를 제공하는 서비스
- MongoDB 소프트웨어와 호환성이 있음
- 데이터를 `JSON 형식` 으로 보관하고 해당 내용 검색 가능
    - 문서 지향 DB 사용 시, **문서의 모든 요소 검색** 가능
    - 키-값 DB 사용 시 **기본 키로만 검색** 가능

### Amazon Neptune

- `그래프 데이터베이스` 를 제공하는 서비스로, **그래프 구조는 데이터 간의 관계성을 나타내는 데 특화**된 구조이다
- 데이터를 나타내는 `노드`, 관계를 나타내는 `엣지`, 노드 및 관계 내용을 나타내는 `속성` 으로 구성됨
    - 속성은 관계에도 부여 가능  ex) 관계 : 팔로우
    - 각 노드의 추가 정보는 속성  ex) 사용자 (노드) 의 성명, 나이
- **SNS 사용자 관계도**가 대표적인 예시로, 사용자의 팔로우 정보, 차단 정보와 같은 관계성 정보도 쉽게 나타낼 수 있음

### Amazon Quantum Ledger Database (QLDB)

- `원장 데이터` 를 관리하는 데이터베이스로, `저널` 이라는 로그 데이터에 기록되는 데이터의 변경이력을 차례로 기록하는 방식
- 저널은 추가만 가능, 변경/삭제 할 수 없어 신뢰성이 높음
- 은행 거래나 제조 이력관리, 보험료 청구처리와 같은 시스템에서 사용하기 용이
- QLDB 의 데이터 본체는 (저널, 즉 이력), 저널을 바탕으로 현재 상태(데이터) 가 만들어짐

### Amazon Managed Blockchain

- 블록체인 네트워크를 구축하는 서비스로, 원장을 기록하는 데이터베이스라는 점은 QLDB 와 비슷
    - 하지만, **한 곳에서 데이터를 집계해 관리**하는 QLDB 와 달리 **데이터를 여러 곳에 분산시켜 보관하는 기술**이므로, 엄밀히 따지면 DB 는 아님
- 개인 간의 금융 거래나 무역에서의 수출입 이력 관리가 한 곳에서 관리되지 않아도 되는 이력에 해당됨
- 이력을 연결해 전체 올바른 이력을 생성 (일관성 없는 이력은 제외)

### Amazon Timestream

- `시계열 데이터베이스` 를 제공하는 서비스로, **센서 등에서 보내는 시간 마다 변화하는 값을 순차적으로 기록하기에 적합**한 데이터베이스로, 데이터의 평활화, 근사, 보간 기능등을 이용한 분석도 가능

### 그 외의 서비스

- Amazon Simple Email Service (Amazon SES) : 메일 전송 서비스
    - 스팸 메일로 걸러지지 않고 상대방에게 전달되게 최적화된 전송 프로세스를 갖춤
- Amazon EventBridge
    - AWS 서비스나 응용 프로그램에서 발생하는 이벤트를 다른 응용 프로그램 또는 AWS 서비스와 연동하는 서비스
- Amazon Simple Notification Service (Amazon SNS) : 메시지 전송 서비스
