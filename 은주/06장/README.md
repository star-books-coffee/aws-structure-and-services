## Chapter 06. 데이터베이스 서비스
### 데이터 불일치를 없애기 위한 ACID 특징

- `원자성` : 트랜잭션은 모두 실행되거나, 실행되지 않아야 함 (ALL OR NOTHING)
- `일관성` : 정해진 데이터베이스 규칙을 만족해야 함 <br>
    ex) 고객 이름이 not null 로 들어가도록 설정했으나, 이름 없는 고객이 추가된다면 일관성을 위반하는 것
- `독립성` : 트랜잭션은 고립되어 있어 연속으로 실행된 것과 동일해야 하고, 이 때 DB 상태도 동일해야 함
- `지속성` : 장애가 있어도 완료된 트랜잭션의 결과는 손실되지 않아야 함, 해당 트랜잭션에 대한 로그가 남아있어야 함

### 관계형 데이터베이스 서비스 RDS

- **Amazon Aurora** : AWS 가 클라우드용으로 구축한 데이터베이스, MySQL 또는 PostgreSQL 과 거의 동일하게 사용할 수 있게 2가지 데이터베이스에 대한 호환성 제공

### DB 성능을 결정하는 인스턴스와 스토리지 유형

- RDS 인스턴스 유형 : 인스턴스의 성능은 인스턴스 크기를 선택해 결정함
- 스토리지 유형 : RDS 에서도 데이터 저장을 위한 스토리 설정 가능

### 가용성 향상을 위한 방법

- 데이터를 처리하는 `프라이머리 인스턴스` 외에 `예비 복제본` 을 다중 AZ 에 배포해 가용성을 높일 수 있음
- `장애조치` : 프라이머리 인스턴스나 AZ 에 장애 발생시 예비 복제본으로 전환해 DB 를 계속 이용하게 함
- 프라이머리 인스턴스에 장애 발생시, RDS 에 할당된 `엔드포인트` 의 목적지가 자동으로 예비 복제본으로 전환됨
- `읽기 전용 레플리카` : 프라이머리 인스턴스에서 복제된 인스턴스
    - 읽기 요청이 늘어나면 **수를 늘리는 스케일아웃 방식**으로 성능 향상
    - 쓰기 성능은 인스턴스 **크기를 변경하는 스케일업**으로 성능 향상
    

### RDS 보안 설정과 백업

- 보안그룹과 네트워크 ACL 에서 설정
- 데이터베이스 엔진 업데이트 : 예비복제본 → 프라이머리 인스턴스 순으로 유지보수 실행
- 데이터 백업 : `자동 백업` 기능이 있어서 지정한 일 수 만큼의 `스냅숏` 자동 유지
    - 백업 윈도우 시간대에 실행되며, 스냅숏 파일은 S3 버킷에 저장되어 내구성이 매우 높음
    - 새 RDS 인스턴스를 생성하는 방식으로 스냅숏 복원 가능
    - 특정 시점 복구 기능을 통해 특정 시간을 지정하고 복원도 가능
 
### AWS 에 최적화된 데이터베이스 : Amazon Aurora

- `DB 클러스터` 라는 단위로 관리되며, 처리를 수행하는 **하나 이상의 DB 인스턴스**와 데이터 관리하는 **클러스터 볼륨**으로 구성됨
    - 클러스터 내의 **인스턴스에서 스토리지가 공유됨**
    - 일반 DB 에서는 EBS 가 인스턴스에 연결되어 **인스턴스별로 데이터가 관리됨**
- 클러스터 볼륨에서는 3개의 AZ 에 2개씩 사본을 작성하여 높은 내결함성을 가짐
    - `쿼럼 모델` 이라는 복제 관리 구조가 사용되어, 쓰기 처리는 4/6, 읽기 처리는 3/6 성공 시 성공이라고 반환

### AWS 에 최적화된 Aurora 기능

- Aurora 복제
    - 1개로 가용성 향상과 읽기 성능 향상을 모두 달성 가능
    - 일반 RDS 는 (가용성 향상을 위한) 예비복제, (읽기 성능 향상을 위한) 읽기 복제를 준비해야 함
    - 쓰기 처리는 클러스터 엔드 포인트에 연결 / 읽기 처리는 `읽기용 엔드포인트` 를 지정해 여러 복제에 분산 처리 가능
- 스토리지 관리는 AWS 가 수행 (스토리지 유형과 용량 지정할 필요가 없음)
- 백업
    - 설정된 보존 기간만큼 지속해서 차분 데이터 취득, 보존 기간 내 임의 시점으로 복원 가능
    - RDS : 스냅숏+변경 로그 형태로 특정 시점으로 복구
    - Aurora : 독자적인 기능과 자동 백업으로 복구
- 다중 리전에 걸친 글로벌 DB
- 2개의 기본 인스턴스가 있는 멀티 마스터 클러스터
- 인스턴스 크기 지정 필요없는 Aurora Serverless
- S3와 연계한 파일 내보내기/가져오기 기능

### 키-값 데이터베이스

- **Amazon DynamoDB** 는 key-value 형 데이터를 저장하는 DB 로, 복잡한 검색은 할 수 없지만 고속 데이터 추출이 가능함
    - key-value 는 데이터 형태로는 자유도가 매우 높지만, RDB 처럼 표 형식이 아니라 집계나 검색이 어려움
- 키-값 형 DB 에서 일련의 데이터를 `레코드` 라고 하며, 레코드의 각 항목 (키, 값) 을 `속성` 이라고 함
    - **레코드가 고유하게 특정할 수 있는 속성 (기본키) 을 가지고 있으면 다른 속성은 어떤 것을 가지고 있어도 상관없음**

### DynamoDB 란

- AWS 가 만든 고속 키-값 데이터베이스
- 키-값 데이터 : 기본적으로 `프라이머리 키` 로만 검색해서 데이터를 가져옴
- 레코드는 `파티션`이라는 보존 영역으로 나뉘어 저장됨
- 서버리스 서비스 ; 테이블 조작 요청은 모두 DynamoDB 가 처리해서 사용자가 서버 관리 안해도 됨
    - EC2, RDS 처럼 사용자가 인스턴스를 소유한다는 개념이 없음 / DynamoDB 라는 하나의 서비스가 요청 처리함

### DynamoDB 보수

- 사용자의 소유물은 데이터 (테이블) 뿐이므로, 테이블 구조 검토나 백업 계획과 같은 데이터 유지보수만 고려하면 됨
- 장애 대비를 위해 DynamoDB 데이터를 이중화하여 저장함 (3개의 AZ에 실시간으로 데이터 복제)
- `특정 시점 복구 (PITR) 기능` : 35일 내 임의의 시점으로 테이블 데이터를 되돌릴 수 있어 데이터 손실이 갑자기 발생해도 대응 가능 / 임의의 시점을 지정해 백업 취득 가능

### DynamoDB 이용 예

- 모바일, 웹, 게임, 광고, IoT 같이 데이터 교환이 매우 많고 사용자에게 `빠른 응답`이 필요한 응용프로그램에 이용됨
    - IoT 기술을 활용한 차량 위치추적 시스템
    - 게임 순위 시스템
    - 웹 광고의 클릭 수 관리
- 실시간 업데이트와 확인이 필요한 시스템에 사용하기 좋음

