## Chapter 4. 스토리지 서비스
### 객체 스토리지

- 기존 파일 스토리지처럼 폴더 구조를 갖는 게 아니라, `객체 키` 로 데이터를 고유하게 식별해 데이터 입출력과 관리 수행
- 키만으로 데이터 관리하므로, 간편하게 **대용량 데이터 저장/관리 가능**
- 정적 콘텐츠만 있는 단순한 html 페이지를 만들고 싶다면, 동영상/이미지/HTML 파일 등을 저장해 웹사이트처럼 운영 가능
- 객체 키만으로 관리되므로 대량 로그 보존도 충분히 가능

### S3 의 특징

- 용량 무제한 : 객체 수나 데이터 용량 제한 X / 객체의 메모리 제한 O
- 높은 내구성 : 일반적으로 데이터가 3개 이상의 AZ 로 복사됨
- 저렴한 비용

### S3에서 사용되는 용어

- `버킷` : 객체 (데이터) 를 저장하는 장소, 버킷명은 전세계 모든 리전에서 고유해야 함
- `객체` : 버킷에 저장된 데이터 본체
- `키` : 객체 저장 url 경로

### S3 데이터 저장하기

- S3 는 비용, 가용성이 다른 여러 `스토리지 클래스` 를 제공
    - S3 Standard (표준) : 기본 스토리지 클래스
    - S3 Glacier Deep Archive
- 거의 사용하지 않지만 **만약을 위해 보존하고 싶은 데이터가 있다면** S3 Glacier Deep Archive 과 같은 저렴한 스토리지 클래스 선택하는 것이 좋다
- 언제든 사용할 수 있는 데이터를 저장하려면 표준 스토리지 선택
- `수명 주기 설정` : 자동으로 스토리 클래스 변경 가능
    - 예시) 생성한지 1년 경과한 객체는 S3 Glacier Flexible 객체로 마이그레이션하는 설정 가능
    - 고비용 → 저비용으로 마이그레이션한 이후에는 표준 클래스로 회귀 불가
- `S3용 액세스 분석기` 를 활용하여 접근 빈도, 데이터 용량 등의 접근 상황을 확인하여 스토리지 클래스를 결정할 수 있음

### 버전 관리 및 다른 리전으로의 복사

- `버전 관리 기능` : 모든 세대의 객체에 대한 이력 정보 보존, S3 버킷 단위로 가능하며 객체 단위의 설정은 불가능
- 삭제했을 경우, 삭제 마커가 부여되며 과거 버전은 유지됨
- `교차 리전 복제` : 데이터 저장 위치와 다른 리전에 복사하는 기능
    - 해외 리전에 데이터 복사하여 데이터 내구성 높익이기
- `재해복구` (DR) : 하나의 리전 전체가 재해를 당한 경우를 가정해 설계하기

### S3 데이터를 안전하게 공개하기

- S3 버킷의 접근 제어하는 3가지 방법
1. **사용자 정책 (IAM 정책)**
    - `데이터 조작하는 사용자`를 제어하는 설정
        - 예시) A는 S3 버킷의 데이터 검색만 가능하고, 업로드는 불가
2. **접근 제어 목록 (ACL)**
    - `객체 (데이터) 또는 버킷 단위`로 설정할 수 있는 접근 제어
        - 예시) 데이터 A는 모든 사용자에게 접근 허용
3. **버킷 설정**
    - `버킷 단위` 로 설정하는 접근 제어
        - 특정 사용자가 특정 파일에 접근할 수 있게 설정하는 식의 복잡한 제어도 가능 (저자 경험상 현장에서 가장 많이 사용됨)
        - 예시) 파일 이름이 logs 로 시작하는 데이터에 접근 허용, IP 주소 XX.XX.. 로부터 접근 허가
- S3의 `퍼블릭 액세스 차단` 기능을 통해 의도치 않게 S3 버킷이나 객체가 공개 상태가 되는 것을 방지할 수 있음

### S3 를 이용해 웹 사이트 구축하기

- S3 의 `웹사이트 호스팅 기능` 을 활성화해서 HTML, CSS, JS 등의 콘텐츠 파일을 이용해 웹사이트 구축 가능
- S3는 **HTTPS 를 지원하지 않으므로**, 민감한 정보가 포함된 사이트 운영할 경우, CDN 서비스인 **Amazon CloudFront** 를 함께 사용하여 HTTPS 통신을 할 수 있게 구성해야 함

### 데이터 암호화

- `데이터 암호화` 실시하면, 데이터와 키 데이터를 조합하여 **데이터 내용을 타인이 볼 수 없게 함**
- 키 데이터가 없으면 데이터를 읽을 수 없게 되므로, 키 데이터를 안전하게 보호해야 함
- S3에서 버킷의 기본 암호화 기능을 활성화하면, 객체 저장시 AWS 에서 자동으로 암호화 수행
    - 암호화용 키 3가지
        1. AWS 외부에서 **사용자가 관리**하는 SSE-C
        2. AWS Key Management Service (KMS) 에서 **사용자가 관리**하는 SSE-KMS
        3. KMS에서 **AWS 가 관리**하는 SSE-S3
- S3 에서 제공되는 기능은 **객체 저장 시 암호화**이므로, S3 로 전송할 때 암호화하고 싶다면 **미리 데이터를 응용 프로그램에서 암호화하여 전송**해야 하고, 이를 `클라이언트 측 암호화` 라고 함
    - 클라이언트 측 암호화에는 사용자 고유키나 KMS 키 사용 가능
    - S3 의 API 에 대한 접근은 기본적으로 HTTPS 에서 수행되므로 통신은 모두 암호화됨
 
### 서버데이터를 저장하는 EBS

- EBS 는 **EC2 와 함께 사용하는 스토리지 서비스**로, EC2 의 HDD/SSD 와 같은 역할을 하며 EC2 에서 실행되는 응용 프로그램의 데이터, 로그, 설정정보 등을 저장하는데 주로 사용
- EC2 인스턴스 생성 시 기본적으로 하나의 EBS 연결되며 추가 연결도 가능
- EBS 는 필요한 속도에 따라 볼륨 유형 선택 가능
    - 읽기/쓰기 성능은 IOPS (Input / Output Per Second) 이라는 초당 쓰기/읽기 횟수를 표현하는 단위 사용

### 서버 백업 및 이미지 관리

- 장애 발생 시 데이터 파손되거나, 실수로 데이터 삭제하는 사고 발생을 방지하기 위해 `스냅숏` 이라는 백업 기능 지원
    - 만들 당시 EBS 에 보존하고 있던 모든 정보가 백업됨
    - 스냅숏은 EBS 볼륨으로 복구해 EC2에 다시 연결해 사용 가능
        - 스냅숏과 몇가지 설정 정보를 조합하여 사용자 전용 AMI 를 생성할 수 있음
        - *Amazon Machine Image(AMI) :* 소프트웨어 구성이 기재된 템플릿 (예: 운영 체제, 애플리케이션 서버, 애플리케이션) AMI에서 *인스턴스*를 바로 시작할 수 있음
     
### S3 와 EBS 외 유용한 스토리지 서비스

- **EBS** : 매우 빠르지만, `하나의 EC2 인스턴스`에만 연결 가능 / 블록 스토리지
- **S3** : 많은 클라이언트가 동시에 사용할 수 있지만, `HTTPS 를 통한 API`를 이용하므로 전송 속도가 그닥 빠르지 않음 / 객체 스토리지
- **EFS (Amazon Elastic File System)** : `비교적 고속으로` 데이터 전송할 수 있는 `**NFS`** (Network File System) 프로토콜을 이용해 `여러 EC2 인스턴스`가 함께 이용할 수 있는 스토리지 / 파일 스토리지
- Amazon FSx : 파일 서버를 구축하기 위한 서비스로 / 파일 스토리지
    - 파일 공유 프로토콜인 `**SMB`** (Server Message Block) 을 이용하는 **Amazon FSx for Windows File Server**
        - SMB 는 윈도우 뿐만 아니라 리눅스 및 맥 OS 도 지원하므로, 다른 OS 에서도 공유 파일 서버 이용하고 싶은 경우 사용**Amazon FSx for Windows File Server** 선택 가능
    - 대규모 클러스터 컴퓨팅, 슈퍼컴퓨터 등에서 사용되는 Lustre 라는 고성능 파일 시스템을 이용하는 **Amazon FSx for Lustre**
- **AWS Storage Gateway** : 온프레미스에 서버 기기를 설치해서 온프레미스 기기와 AWS 의 S3, FSx, EBS를 직접 연결하는 서비스
    - Storage Gateway 는 NFS 나 SMB 로 연결하는 스토리지처럼 처리되므로, 직접 AWS 서비스와 데이터를 교환하는 것보다 빠름

### AWS Transfer Family

- S3, EFS, HTTP, NFS 가 아닌 SFTP (Secure File Transfer Protocol), FTPS (File Transfer Protocol over SSL)M, FTP (File Transfer Protocol) 과 같은 `FTP 기반 프로토콜` 로 통신하기 위한 서버를 구축하는 서비스

### AWS Backup

- AWS 의 EBS, EFS, FSx 와 같은 스토리지, RDS 나 DynamoDB 와 같은 데이터베이스의 데이터를 백업하는 서비스
- 백업 규칙 설정 시, 백업이 자동 실시
- 백업은 S3 에 저장되므로, 가용성/내구성 매우 높음

### AWS DataSync

- 온프레미스와 AWS, 또는 AWS 스토리지 서비스 간 데이터 전송을 위한 서비스
- 온프레미스 서버에 DataSync 에이전트 설치해서 S3, EFS, FSx 와 같은 스토리지 서비스와 간단히 데이터 주고 받을 수 있음
- 그럼 AWS Storage Gateway 랑 차이점은 뭘까
    - DataSync 는 주로 `데이터 이동` 에 중점, Storage Gateway 는 `하이브리드 스토리지 아키텍처 및 로컬 스토리지와의 연결` 에 중점

### AWS Snow Family

- 물리 스토리지를 AWS 에서 빌려 그곳에 데이터를 저장하고, AWS 로 반환하면 해당 데이터를 직접 AWS 내의 스토리지로 옮겨주는 서비스
    - 데이터가 들어있는 Snow 디바이스 (물리 스토리지) 를 AWS 에 반송하면, 안의 데이터를 S3 에 저장
    - AWS 에서 전송된 Snow 디바이스 (물리 스토리지) 로 데이터 전송
- 대량의 데이터 전송을 최대한 빠르게 할 수 있음
