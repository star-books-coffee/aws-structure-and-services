# Chapter 3. 컴퓨팅 서비스

### 대표적인 서버 유형

- **웹 서버**
    - 웹사이트를 구성하는데 필요한 데이터 저장 및 시스템 제어
    - **EC2, ECS 로 구현**하는 경우가 많음
- **데이터베이스 서버**
    - 데이터베이스 관리 시스템이 설치된 서버
    - EC2 에 DBMS 설치해서 DB 서버 구축해도 되지만, **RDS 나 DynamoDB** 이용할수도 있음
- **메일 서버**
    - SMTP 프로토콜, POP3 프로토콜을 이용해 메일 송신/전달/수신하는 서버
        - `SMTP` (Simple Mail Transfer Protocol) : 이메일 전송 시 사용
        - `POP3` (Post Office Protocol 3) : 이메일 수신 시 사용
    - 메일 전송 과정
        1. 메일전송자는 메일 클라이언트 프로그램에서 메일 작성 후, **SMTP 서버에 메일 전송 요청**
        2. SMTP 서버는 요청을 받아, **해당 메일 수신처를 DNS 서버에서 확인** (어디로 메일 보내야할 지 특정)
        3. 해당 메일 주소로 메일 전송
    - EC2 에 메일 서버 구축 가능, **Amazon SES** 이용 가능

### 웹 서버 작동 방식

- 웹 서버는 클라이언트를 `웹 브라우저` , 서버를 `웹 서버` 로 지정해 클라이언트-서버 통신을 함

### 서버 OS 란

- OS : 기기의 관리/제어를 수행하기 위한 인터페이스, 하드웨어 관리 기능, 기기에서 동작할 SW가 공통으로 이용할 기본 기능을 구현한 소프트웨어
- 리눅스
    - Red Hat Enterprise Linux (RHEL)
    - `CentOS` : **RHEL 의 복제 OS**로, RHEL 상용부분 제거한 리눅스 배포판
    - `Debian GNU/Linux` : Debian 프로젝트에서 개발한 리눅스 배포판
    - `Ubuntu Linux` : **Debian 기반**으로 만들어진 리눅스 배포판
- 윈도우 서버
    - 마이크로소프트에서 출시한 서버용 OS
    - GUI 로 조작하며, 데스크톱 윈도우와 사용법이 비슷

### 서버 가상화

- 일반적으로 <1대의 기기 - 1개의 OS> 지만, 가상화 SW를 사용하면 <1대의 기기 - n개의 OS> 가 가능하다
→ 서버의 가상화
- 물리서버 == 단독주택이어서 1 가족만 살 수 있음
가상서버 == 아파트여서 n 가족 살 수 있음
- `서버 가상화` : 하드웨어를 **나눠서 독립된 가상서버**를 만드는 것
    - 하드웨어 자원에 따라 얼마나 많은 서버를 만들지 결정됨 (건물크기에 따라 몇 가족 살 수 있는지 결정됨)
    - 서버는 CPU/메모리 같은 컴퓨팅 자원의 규모를 결정해야 한다 (가족별로 방크기가 얼마나 되는지 결정)

### AWS 에서의 가상화

- **Amazon EC2** 가 대표적인 예로, EC2 는 AWS 의 대규모 서버에서 가상화 수행
- 사용자는 OS 종류 / CPU / 메모리 크기를 자유롭게 선택해 **인스턴스** (가상 서버) 생성 가능    
    ![Untitled](https://file.notion.so/f/f/3db2c1d3-d28f-483a-adc8-ee8abc696878/0f1da81f-d1ab-4783-8e6e-5636ded68de2/Untitled.jpeg?id=a8b1a1ab-e9d8-4d11-ba57-7d9c1763ae68&table=block&spaceId=3db2c1d3-d28f-483a-adc8-ee8abc696878&expirationTimestamp=1695823200000&signature=T5lQCIUHBwJGLH31lLrh8-AGNWGn9QxFj5MDSKq45Qo&downloadName=Untitled.jpeg)
    

### Amazon EC2 : 가상 서버 서비스

|  | 온프레미스 | EC2 |
| --- | --- | --- |
| 응용 프로그램 | 사용자 | 사용자 |
| 확장성 및 가용성 관리 | 사용자 | 사용자 |
| OS 설정 | 사용자 | 사용자 |
| OS 설치 | 사용자 | AWS |
| 서버 하드웨어 | 사용자 | AWS |
| 데이터 센터, 전원, 네트워크 | 사용자 | AWS |
- EC2 는 가상 서버를 `인스턴스` 단위로 관리함
- EC2 인스턴스 생성하기 위해서는 아래의 설정이 필요
    - **Amazon 머신 이미지 (AMI)**
        - `OS 와 소프트웨어`가 설정된 템플릿
        - ex) Amazon Linux, Mac OS
    - **인스턴스 사양 (유형)**
        - `가상 서버의 성능`이 결정됨 (CPU, 메모리 용량)
        - 인스턴스 유형으로 **인스턴스 서버 성능이 결정된다**
            ![Untitled](https://file.notion.so/f/f/3db2c1d3-d28f-483a-adc8-ee8abc696878/d34340b8-c286-43de-914e-7b02132742a3/Untitled.png?id=6d28c1a5-d98e-43d8-bdc0-21f277b9920c&table=block&spaceId=3db2c1d3-d28f-483a-adc8-ee8abc696878&expirationTimestamp=1695909600000&signature=0Z7L6YqsSuI7_zxLNveWvzGoKC8rFJDKLpRnQi2XpgU&downloadName=Untitled.png)
            - Instance Family : 메모리, CPU 중 어느 것을 우선시하느냐와 같이, **인스턴스 특징에 따른 문자열**
              
                | 패밀리 | 특징 |
                | --- | --- |
                | T | 버스트 가능한 범용 유형 |
                | M | 균형 잡힌 범용 유형 |
                | C | 컴퓨팅 최적화 (vCPU 수가 많음) |
                | R | 메모리 최적화 (메모리 탑재량이 많음) |
                | P | 고속 컴퓨팅 |
                | I | 스토리지 최적화 |
                - T 유형은 베이스라인이라는 정해진 CPU 사용률이 정의되어 있는데, 그 이상을 사용해도 되지만 추가요금 발생함
                - 서비스 환경과 같이 상시 사용이 예상될 때는 M 유형을 선택하는 것이 좋다
                - ex) t2.micro, t3.large …
            - Instance generation : 세대
            - Attribute : 네트워크에 특화된 인스턴스 (없을 수도 있음)
            - Instance Size : 크기가 클수록 고성능
    - **배포할 네트워크**
        - 가상 머신이 위치할 네트워크는 `사용자가 생성한 VPC 선택`
    - **데이터 저장할 스토리지 용량**
        - EBS (Elastic Block Store) 설정
    - **사용 권한 설정 (보안그룹)**
        - 보안그룹 선택

### 다양한 EC2 요금제

- `온디맨드 인스턴스` : 일반적으로 사용하는 EC2 인스턴스
    - 이용 상황에 변화가 있고, 사용 예정일을 모르는 경우
- `예약 인스턴스` : 1년 or 3년간 요금 선불로 지불하고 이용
    - 프로덕션 가동 등 1년 이상 사용 예정이 있는 경우
    - `절감형 플랜` : 예약 인스턴스와 매커니즘은 동일하지만, 유연하게 요금 설정 가능
        - 인스턴스 패밀리, 크기를 지정하지 않고 여러 패밀리나 크기 할당해서 구매 가능
        - 다양한 서비스 운영해야할 때 유리함
- `스팟 인스턴스` : AWS 에서 이용하지 않는 자원을 활용해 인스턴스 생성하고 최대 90퍼 할인
    - 용량을 반환해야 하거나, 지정비용 초과시 AWS 측에서 중지 가능
    - 개발환경과 같이 인스턴스 중단해도 영향이 작은 경우에 용이
 
### 서버 외부에 공개하기

- EC2 를 인터넷에 공개하기 위한 3가지 조건
    1. EC2 를 `퍼블릭 서브넷` 에 배치
        - 퍼블릭 서브넷 == 인터넷과 통신할 수 있는 서브넷
        - 프라이빗 서브넷 == 인터넷과 직접 통신할 수 없는 서브넷으로, AWS 내에서 통신 가능
        - 서브넷은 **EC2 를 배치하는 네트워크**
    2. `퍼블릭 IP 주소` 를 EC2 에 부여
        - 퍼블릭 IP 주소 == 인터넷과 통신할 수 있는 IP 주소
        - IP 주소는 **EC2 의 위치를 나타내는 주소**
    3. `보안그룹` 에서 외부로부터의 접근을 허가
        - 웹 사이트라면 80 이나 443 포트 허가
    - 보안그룹 : 특정 인스턴스가 특정 주소 또는 특정 대역, 전체 인터넷과 통신할 수 있도록 규칙을 만들어, 규칙에 따라 통신을 제어하게 함

### 서버 접근 제어 보안

- 보안그룹은 어느 곳에서 어느 곳으로 접속을 허가할 지에 대한 접근 제어를 담당
    - 온프레미스의 **방화벽** 기능 수행
- `인바운드` : 외부에서 EC2 로의 통신
    - 0.0.0.0/0 은 모든 네트워크로부터 EC2 로 들어올 수 있음을 의미
    - 보안 그룹에 규칙 추가 시, IP 가 아니라 **다른 보안 그룹 지정하는 것도 가능**
        - EC2-A, EC2-B 인스턴스 존재할 때 EC2-A 에서 EC2-B 로 통신허가해야 하는 경우, **EC2-B 보안 그룹에 EC2-A 보안그룹 ID 지정시** 내부적으로 EC2-A 의 IP가 지정되어 통신이 허가됨
        - EC2 IP 를 직접 입력하는 것보다 ID 를 입력하는 것이 안전함 (그룹 ID 는 변경 여지가 없기 때문)
- `아웃바운드` : EC2 에서 외부로의 통신
    - 기본 설정은 외부로의 모든 통신을 허용하고 있음
- 보안 그룹에 지정하는 규칙은 `허용만 가능` / `차단은 불가능`

### 부하에 따라 서버 자동 추가/삭제하기

- **EC2 Auto Scaling** 기능 사용 시 서버 추가 및 제거를 상황에 맞게 자동 수행 가능하다
    - 서버 추가 : Scale-out
    - 서버 제거 : Scale-in
- `CPU 사용률`에 맞춰 서버 추가 or CPU 추가 가능 (시작 템플릿에 AMI - Amazon 머신 이미지 정보와 서버가 추가될 조건 설정해두면, 조건에 맞게 자동 추가됨)
- `목표 사용률` 을 지정해서 지정한 값을 유지하게끔 인스턴스 수를 자동 조절하는 대상 추적 조정 정책
- `사용자 접속수` 와 같은 기준을 이용한 자동 추가 및 삭제도 설정 가능
- 일정을 세워 인스턴스 수를 조절하는 `스케줄 스케일` 존재하며, 주말이나 연휴 등 접속자 수를 예측할 수 있는 경우 용이
- Auto Scaling 은 장애 대비용으로도 사용됨, 예기치 못한 장애 발생해 인스턴스가 멈췄다면 자동으로 인스턴스 새로 만들어짐

### 서버리스 컴퓨팅 서비스 Lambda

- 서버리스 : **실제로 가동하는 서버가 없다는 말이 아니라**, AWS에서 서비스가 실행될 인프라를 관리하므로 **사용자가 관리할 서버가 없다는 것**
    - 보안 : 장애, 보안패치 등도 AWS 소관하에 이루어지므로 사용자는 코드만 관리하면 됨
    - 비용 : 코드가 실행될때만 요금 부과
    - 가용성 : 복수의 가용환경 (AZ) 에서 실행가능, 사용자가 설정하지 않아도 고가용성, 장애대응성이 유지됨
    - 확장성 : 동시에 다수 처리를 해야하는 경우, 자동으로 AWS의 처리용 인스턴스가 시작되면서 확장됨
- EC2 장점 및 Lambda 와의 비교
    - 온프레미스를 이전하는 경우 OS설정 등을 그대로 유지 가능
    - 인스턴스 유형, OS, 네트워크 등을 자유롭게 설정할 수 있다는 유연성 존재
    - 대량의 트래픽 / 접속을 상시 처리하는 경우에는 오히려 저렴할 수 있음
    - 서버에 프로그램을 배포한다는 기존 방식으로 개발 가능, Lambda는 AWS 독자적인 개발방법이라 어려울 수 있음

### Lambda 실행 방법

- Lambda 는 `함수` 단위로 코드를 관리 및 처리
1. 함수 생성 (함수명, 사용할 프로그래밍 언어 및 버전 지정)
2. 함수에 전달할 데이터를 json 형식으로 지정
3. 테스트 버튼을 눌러 실행 결과 확인
- 별도의 환경 준비없이도 쉽게 실행할 수 있다는 장점이 있음
- 화면상에서 편집 가능한 언어는 파이썬, nodeJS 처럼 컴파일이 불필요한 언어

- 입력받은 데이터를 함수를 수동으로 실행하기도 하지만, 다른 AWS 서비스와 연동하여 사용자 접속, 데이터 연동 처리를 자동 수행할 수도 있음

**< 사용자 요청에 따라 Lambda 함수 실행 >**

- **Amazon API Gateway** 와 **Lambda** 를 결합하여 **사용자 HTTP 요청을 Lambda 함수로 처리 가능**
    1. API Gateway 가 사용자로부터 HTTP 요청받으면, HTTP 메소드나 요청경로에 대한 정보가 포함된 JSON 데이터를 Lambda 함수에 전달
    2. Lambda 함수에서 응답 내용 반환하도록 코드 작성
    3. API Gateway 를 통해 응답 반환

**< S3에 데이터 저장 시 자동 처리 >**

- 데이터에 포함된 정보 가공 하여 다른 S3 버킷에 저장하는 등의 처리도 가능하다
    - Amazon S3 버킷에 데이터 저장 → Lambda 함수를 실행하여 저장된 데이터를 가지고 정보를 가공 → 또 다른 S3 버킷에 저장

**< 주기적으로 Lambda 함수 실행 >**

- 주기적으로 정해진 시간에 어떠한 처리를 하고 싶다면 **AWS EventBridge** 와 연계 가능
    - EventBridge 에 매일 실행할 내용을 ‘규칙‘ 형태로 정의 → 실행대상에 lambda 함수 지정

### Lambda 에서 변경할 수 있는 설정

- 메모리 용량 : 함수 실행 시 사용할 수 있는 메모리용량 / CPU 값은 지정 불가
- 타임아웃 시간 : 함수가 실행되는 최대 시간
- 환경 변수 : 함수에 사용하는 외부 변수
<br>

- lambda는 S3에 데이터 저장하거나, EC2 를 시작/중지하는 등 **다른 AWS 자원을 조작하기 위한 목적으로 사용되는 경우가 많음**
    - 처음 lambda 함수를 만들면 다른 서비스에 대한 `접근 권한` 을 **함수에 부여**해야 함 (IAM 형태로)
    - IAM 역할을 부여하지 않으면 자동으로 기본 IAM 역할이 설정되는데, **Amazon Cloudwatch** 라는 감시서비스로 로그를 보낼 수 있는 권한만 부여됨
    - **lambda 에 권한 설정할 때는 처리내용에 필요한 최소한의 권한을 설정하는 게 중요**

### Lambda 함수 모니터링
- lambda 함수를 만들어 배포하면, **Amazon Cloudwatch** 모니터링 서비스로 정보 (실행횟수, 실행시간, 오류수와 실행 성공률) 자동 전송
    - 함수의 자세한 실행 결과도 확인 가능
 
### 컨테이너의 구조와 특징 이해
- 가상 서버 : 아파트
    - **1대의 물리 서버**에서, **복수 개의 가상서버** 동작
    - **가상 하드웨어 위에 OS, 미들웨어**가 설치되어 있어 그 위에서 프로세스 (응용프로그램) 실행됨
    - 하이퍼바이저로 가상화 기술을 구현
- 컨테이너 : 셰어하우스
    - **1대의 물리 서버**에서, **복수 개의 컨테이너** 동작
    - OS와 물리자원은 **각 컨테이너가 공동으로 이용**
    - 컨테이너는 네트워크가 분리되어 있지만, 외부 네트워크와의 통신 / 컨테이너 간 통신을 할 때는 `컨테이너 런타임`(도커, containered) 을 통해 이루어짐
- 서버 : 집
- 서버에서 실행되는 응용 프로그램 : 거주자
- 컨테이너
- `컨테이너 이미지` : 컨테이너가 어떤 응용프로그램, OS를 기반으로 실행할 지 미리 정의해둔 파일
    - 컨테이너 실행에 필요한 파일은 이미지에 포함됨
    - 이미지 기반으로 여러 컨테이너 실행 가능

### 가볍고 빠른 컨테이너

- 컨테이너에 포함된 것이 적기 때문에 가상화에 비해 가볍고 빠름
- 가상 서버 이미지에는 OS, 미들웨어, 응용프로그램 등이 모두 필요하지만, 컨테이너 이미지에는 응용 프로그램 (의존성 패키지, 실행파일) 만 포함 되어있어 이미지 크기에 차이가 있음
- 처리속도 또한 **OS에 대한 오버헤드가 없는 만큼** 컨테이너가 가상서버보다 빠르게 시작된다
    - 가상서버 : OS →미들웨어 → 응용프로그램 순서로 시작
        - 응용프로그램은 `하이퍼바이저` 를 통해 호스트 서버자원을 이용해 수행
    - 컨테이너 : 직접 응용프로그램 실행
        - 응용프로그램은 `컨테이너 런타임`을 통해 호스트 서버 자원을 이용해 실행됨

### 배포의 용이성

- 컨테이너 이미지는 한번 생성하면, 이미지 내부의 내용은 바뀌지 않으므로 다른 서버에서도 바로 사용이 가능
    - 재현성 (실험, 분석 또는 연구의 결과를 원래 사용했던 것과 동일한 방법, 데이터 및 절차를 사용하여 재현하거나 재창조할 수 있는 능력) 이 높으므로 환경에 의존하지 않음
- 압축파일 형태로 내보내거나 가져오기 수행 가능
- 컨테이너 런타임이 있으면, 같은 컨테이너 이미지를 사용해 동일한 수행이 가능
- 컨테이너 == “완성된 이미지” 이므로, 컨테이너 종료 시 내부에 저장된 내용이 사라지므로, **컨테이너가 실행될 호스트 서버의 디렉토리를 마운트**해서 작업 내용을 저장해야 함

### 컨테이너 오케스트레이션

- 쿠버네티스,  Docker Swarm
- 여러 컨테이너를 하나의 시스템처럼 운영하기 위해 모두 따로 관리하려면 관리 부하가 높아지므로, `컨테이너 오케스트레이션 도구` 를 활용해 관리를 자동화하여 운영 부하 줄임
    - 상태 모니터링
    - 스케일링 기능
