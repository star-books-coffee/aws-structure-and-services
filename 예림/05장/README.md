# Chapter 5. 네트워크 및 콘텐츠 전송 서비스
## 📌 네트워크 중요 용어 익히기

### IP 주소(Address)는 네트워크의 번지(주소)

- 웹 서버의 위치 : 데이터 센터 or 클라우드 서비스
- 웹 서버에 접근하기 위해서는 웹 서버가 그곳에 있다는 특정 정보 필요 → `IP 주소`
- 표준 : IPv4
    - 4개의 숫자를 점으로 구분해 표시

> 요즘은 인터넷에 접속 기기 증가 → IPv6 주목 받고 있음. BUT 보편적으로 보급되지는 않아서 여기선 IPv4 기준으로 설명
> 

### 퍼블릭 IP 주소와 프라이빗 IP 주소

- `퍼블릭 IP 주소` vs `프라이빗 IP 주소`
    - 퍼블릭 IP 주소 : 전 세계에서 식별 가능
    - 프라이빗 IP 주소 : LAN 내에서만 식별 가능
- 프라이빗 IP 주소로 사용할 수 있는 범위가 정해져 있고, 나머지는 퍼블릭 IP 주소

### CIDR 블록으로 IP 주소 범위 결정

- `CIDR` : IP 주소를 이용해 네트워크 범위를 정의하는 것
- IP 주소를 나타내는 숫자열은 크게 `네트워크` 부분과 `호스트` 부분으로 나눌 수 있음.
- 다음은 Amazon VPC의 기본 VPC의 CIDR 블록
    
    ```json
    172.31.0.0 /16
    
    2진수 표기 : 10101100 . 00011111 . 00000000 . 00000000
    서브넷 마스크 11111111 . 11111111 . 00000000 . 00000000
    ```
    
    - IP 주소 다음에 /와 숫자로 네트워크 범위를 표기한다.
    - ⭐️ `/16` : 서브넷 마스크라고 하며 IP 주소를 사용해 네트워크 범위를 정의한다면 보통 이 표기를 사용. (10진수로 표기)
        - `/16`이면 상위 16비트가 네트워크 부분임. 2진수 표기로 왼쪽에서 16번째까지 1로 표기된 부분
    - `0` : 첫 번째 0이 호스트에 해당. /16의 경우 하위 /16비트가 해당. 이 경우 사용할 수 있는 주소는 2^16개

### 방화벽에서 허용된 통신만 통과

- `방화벽` : 보안 휘협으로부터 시스템을 지키기 위해 사용하는 것
- 종류 : 하드웨어 형태의 방화벽 / 소프트웨어 형태로 서버에 설치돼 동작하는 방화벽
    - ex) 윈도우 PC ‘보안센터’ 설정 → 방화벽 설치되어 있음
- AWS에서는 보안그룹이나 네트워크 ACL

### 부하 분산을 위해 여러 서버에 접속을 분배

- 많은 사용자가 사용하는 시스템 → `부하 분산` 고려 필요
- `로드 밸런서` : 서버를 여러 대 구성해 각 서버가 처리를 나눠서 할 수 있게 구축하는 장치

### 라우팅 및 라우팅 테이블

- `라우터`가 최적의 경로를 찾아서 경로를 결정하고 연결해줌.
- 라우팅 : 라우터가 원하는 IP 주소를 향한 경로를 결정하는 것
- 어떻게 라우팅하는 게 효율이 좋을지 결정해야 함.
- 각 라우터는 소유한 경로 정보를 기반으로 목적지 IP 주소를 향해 이동해야 하는 네트워크를 결정하는데, 이 경로 정보를 `라우팅 테이블`이라고 함.
    
    ⇒ 라우터가 소유한 네트워크 지도
    
- AWS에서는 Amazon VPC의 라우팅 테이블이라는 기능이 이에 해당
    - 각 AWS 서비스에 대해 어떤 엔드포인트를 경유할지와 같은 경로 정보 관리 가능

### 도메인 이름과 IP 주소를 연결하는 DNS

- `도메인` : [OO.com](http://OO.com) 과 같이 해당 문자열에 표시되는 기업, 단체 등이 제공하는 사이트 주소를 정의
    - 점으로 연결된 문자열로 구성돼 있으며 기업 이름과 단체 이름을 표현하는 경우가 많음.
- 도메인 이름에는 IP 주소가 연결되어 있어 도메인 이름으로만으로 접속 가능
- `DNS` : 우리 대신 도메인 이름에 연결된 IP 주소를 찾아줌. 이러한 DNS의 기능을 `이름 해석`이라 함.

## 📌 VPC에서 VPC, 외부 서비스, 온프레미스와의 연결

### VPC와 외부 네트워크 연결

- 다른 VPC나 VPC 외 다른 AWS 서비스와 연결하는 기능을 소개한다.
- `VPC 피어링` : 서로 다른 VPC를 연결해 통신 가능
    - 주의 : 서로 연결된 VPC의 CIDR 블록은 겹치면 안됨.
- `AWS Transit Gateway` : VPC 연결을 하나의 중앙 허브에서 관리 가능
    - 주의 : 요금이 VPC 피어링보다 높음
    - 추천 : 많은 VPC 사용할 때

### VPC와 VPC 외 AWS 서비스를 연결

- S3 등 외부에서 동작하는 AWS 서비스는 보통 인터넷으로 통신
- BUT `VPC 엔드포인트`를 이용하면 프라이빗 네트워트로 통신 가능
    - 인터넷을 통하지 않고 AWS 내부 네트워크를 통해 연결 가능
- VPC 엔드포인트를 설정한 VPC는 S3 와 같은 다른 AWS 서비스에 직접 접근 가능
- `게이트웨이 엔드포인트` : S3나 Dynamo DB에서 사용하는 VPC 엔드포인트
    - AWS 서비스와의 통신은 퍼블릭 IP 사용
    - S3와 Dynamo DB만 지원
- `인터페이스 엔드포인트` : `AWS PrivateLink` 기능을 사용해 서브넷에 서비스 접속용 ENI(네트워크 인터페이스)를 생성해 프라이빗 IP로 통신
    - 많은 AWS 지원

### VPC와 온프레미스 네트워크 연결

- VPC는 온프레미스 네트워크와도 연결 가능
- 연결 방법 몇 가지를 소개한다.
- `AWS Site-to-Site VPN`
    - 온프레미스 환경의 네트워크와 VPC를 VPN으로 연결하는 기능
    - VPN : Virtual Private Network → 가상으로 프라이빗 네트워크 구성해 통신하는 기술
        - VPN에 접속하면 외부 네트워크와 프라이빗 IP주소로 통신 가능
    - 프라이빗 접속 방법 : 온프레미스 환경에 있는 라우터 기기에 AWS 접속을 위한 설정을 하고 AWS에도 접속 설정
    - 프라이빗이라고는 하지만 인터넷을 통해 통신이 이루어짐. IPsec VPN이라는 기술을 사용해 인터넷에 가상으로 전용 네트워크를 만드는 형태
- `AWS Client VPN`
    - 온프레미스 환경이 아니라 특정 단말과 비공개로 연결하고 싶은 경우 사용
- `AWS Direct Connect`
    - AWS와 온프레미스 환경을 전용선으로 연결
    - AWS 데이터 센터와 직접 연결하응 게 아니라 Direct Connect 로케이션이라는 기존 연결 지점을 통해 연결
    - VPN 연결과 비교 : 고품질 네트워크 사용 가능 / 이용비용이 높음 / 서비스 이용 준비 기간이 길다
 
## 📌 다른 AWS 서비스와 결합된 구성 예

### VPC 구성 예

- AWS 서비스는 실행 위치에 따라 다음 그림처럼 세 가지 유형으로 나뉜다.

<img src="https://blog.kakaocdn.net/dn/1sY1a/btqCgRMI5lu/1KOUmpAAznvGJD3DGXnNE1/img.png" width=500>

1. 글로벌 서비스 : 특정 리전에 의존하지 않고 실행되는 서비스. ex) CloudFront, IAM 등
2. 리전 서비스 : 리전 내, VPC 외부에서 실행되는 서비스 ex) S3, DynamoDB 등
3. AZ 서비스 : VPC 내에서 실행되는 서비스 ex) EC2, RDS 등

> AZ 서비스는 VPC 안에서, 그 외 서비스는 VPC 밖에서 실행
> 

**구성 예 1 : Web + DB + Amazon CloudFront**

- 온프레미스 환경의 웹 서버, DB 서버 환경을 AWS로 마이그레이션할 때 자주 볼 수 있는 구성
- 하나의 리전(서울)에서 프라이빗 네트워크로 VPC 생성 → RDS 같은 자원 배치 → 서버 역할 별로 서브넷 셍성
- 멀티 AZ 대응을 위해 역할 별로 2개의 서브넷 준비
- ALB(VPC 외부로부터 통신을 수신)만 **퍼블릭 서브넷**에 배치
- 다른 AWS 서비스를 VPC 내에서 사용하는 경우에도 역**할 당 2개 또는 3개의 서브넷 준비**
- CloudFront를 이용하면 세계 각지에 있는 엣지 로케이션에 웹 콘텐츠가 캐시되므로 지연시간을 최소화할 수 있음

**구성 예 2 : VPC 엔드 포인트를 사용하는 S3 연결**

- RDS에서 취득한 데이터를 S3에 저장하거나 그 반대

**구성 예 3 : 온프레미스 환경에서 프라이빗 연결**

- Site-to-Site VPN을 모두 이용해 프라이빗 연결
- VPC와 온프레미스 환경만 통신 가능 (인터넷과 통신할 수 없는 구성)

## 📌 ELB로 부하를 분산시켜 가용성 향상

### ELB란

- Elastic Load Balancing : AWS에서 제공하는 로드 밸런서
- 주요 기능 : 응용 프로그램으로 트래픽을 로드 밸런싱하는 것
- 부가 기능 : 트래픽을 보내는 서버가 멈추지 않고 실행 중인지 정기적으로 확인해 가용성 확인

**부하분산**

- 트래픽을 여러 대상으로 전달하도록 지정하면 사용자의 접속 자동으로 분산 가능
- 원리 : 2개 이상의 EC2 인스턴스를 대상으로 등록해 사용자가 그 대상 중 하나로 접속하게 분산 → 많은 양의 접속이 발생해도 ELB가 적절하게 분산시키므로 서버 부하가 줄어듦

**대상 모니터링**

- ELB는 항상 대상에 대한 연결과 상태를 감시하고 확인
- `CloudWatch` 지표 취득 가능
- 비정상적인 동작을 감지하면 대상을 자동으로 분리해 안정적인 작동을 유지할 수 있음

**보안기능**

- 보안 그룹을 비롯한 AWS의 기본적인 보안 서비스 적용 가능
- SSL/TLS 서버 인증서를 설정해 암호화 통신을 수행 가능
- 단, `NLB`는 보안 그룹을 설정할 수 없음

### ELB 유형

- ELB는 용도에 따른 로드 밸런서를 제공
- Application Load Balancer(ALB)
    - HTTP 트래픽과 HTTPS 트래픽의 부하 분산 가능
    - 레이어 7로 동작하므로 마이크로 서비스나 컨테이너 등 다양한 응용 프로그램에도 대응 가능
- Network Load Balancer(NLB)
    - 레이어 4(전송 계층)에서 동작하므로 HTTP/HTTPS 외에 TCP, UDP, TLS 트래픽의 부하 분산도 가능
    - 수백만 건 이상 요청이 발생하는 대규모 트래픽에서도 속도가 빠름
- Class Load Balancer(CLB)
    - ALB, NLB 서비스 이전부터 제공된 구형 로드 밸런서
    - 레어어 4 및 레이어 7에서 동작
    - 특별한 경우 아니고선 사용 X
- Gateway Load Balancer(GWLB)
    - AWS에서 제공하는 타사 보안 제품의 배포 및 관리 가능
    - 레이어 3에서 동작
    - 기존 NLB 및 VPC 피어링, Transit Gateway에서 구현하던 아키텍처를 더욱 단순하게 구현

### ELB 요금 예

- 1시간당 로드 밸런서 사용료(고정)와 로드 밸런서 커패서티 유닛 이용료(변동)를 합산해 계산
 
## 📌 간편하게 사용할 수 있는 DNS 서비스

### Route 53

- `Route 53` : AWS가 제공하는 DNS 서비스
    - 완전 관리형 → 유지 및 관리 작업 필요 X
    - 글로벌 서비스 → 모든 리전에서 공통으로 사용 가능
- 관리 : `호스팅 영역` 별로 수행
    - 호스팅 존 : 도메인과 해당 하위 도메인의 트래픽 라우팅 방법에 대한 정보를 보관하는 상자
    - 등록한 각 도메인에 대해 호스팅 영역이
    만들어지고 다양한 설정이 관리된다
- 특징
    1. 높은 가용성
    2. 높은 비용 성능

### Route 53 기능

크게 세 가지 기능

- 도메인 등록 기능
- 도메인 트래픽 라우팅
- 자원에 대한 상태 확인

### 도메인 등록 기능

- 임의의 호스팅 영역 생성해 도메인 등록 가능
- 임의의 도메인 이름을 Route 53에서 `DNS 레코드`로 등록 가능
- DNS 레코드 : DNS가 관리하는 도메인과 어떤 IP 주소, 정보가 연결돼 있는지를 기록한 데이터
    - DNS는 이 DNS 레코드를 기반으로 질의한 곳에 도메인에 해당하는 IP 주소를 반환
- DNS 레코드 종류
    - A : Ipv4 주소에 대한 레코드
    - AAAA : Ipv6 주소에 대한 레코드
    - CNAME : 특정 호스트 이름에 대한 별칭을 정의하는 레코드
    - NS : 호스팅 영역의 네임서버 이름 정의하는 레코드

### 도메인으로 트래픽 라우팅

- 생성한 DNS 레코드 별로 `라우팅 정책` 설정 가능
    - 여기서의 라우팅 : 라우터의 라우팅과 다르게 도메인 이름에 대한 IP 주소를 어떻게 반환하는지를 의미
- 단순 라우팅
    - 일반적으로 DNS와 같은 라우팅을 수행
        
        ⇒ 하나의 도메인에 대해 하나의 IP 주소만 연결
        
- 가중차 기반 라우팅
    - 라우팅 대상을 여러 개 등록하고 각각에 트래픽을 할당하는 정도를 0에서 255 사이의 값(가중치)으로 지정
    - 가중치에 따라 어느 IP 주소를 반환하는지 결정
- 지리적 위치 라우팅
    - 조회한 곳의 위치 정보에 따라 어떤 IP 주소를 반환할지를 결정
- 지연 시간 라우팅
    - 항상 레이턴시(데이터 처리 지연시간)가 최소인 자원의 IP주소를 우선적으로 반환
- 장애 조치 라우팅
- 다중값 응답 라우팅

### 자원 상태 확인

- `상태 확인 기능` : 대상이 정상적으로 실행 중인지 확인
- 대상이 정상인지 판단하는 기준 : 라우팅하는 곳에서 반환되는 응답 결과 확인하기
    - 엔드 포인트
    - 다른 상태 확인의 상태(산출된 상태 확인)
    - CloudWatch 알람 상태
- 상태 확인 결과를 바탕으로 자동 라우팅 변경 & 알람과 같은 동작을 추가해 서비스가 안정적으로 실행될 수 있게 함.
- 상태 확인 요금 있음.

## 📌 CloudFront로 빠르고 안정적인 서비스 제공

### CloudFront란

- `CloudFront` : AWS가 제공하는 콘텐츠 전달 네트워크(CDN) 서비스
- CDN : 대용량 디지털 콘텐츠를 인터넷에서 효율적으로 사용자에게 전달하기 위한 네트워크
- CDN의 원리
    - 데이터 본체를 저장하고 있는 `원본 서버(Origin Server)`에서 그 데이터의 `복사본(캐시)`을 전 세계에 존재하는 캐시 서버에 저장 → 사용자의 위치를 파악해 자동으로 가까운 곳에 있는 캐시 서버로 연결해 사용자가 빠르게 데이터를 취득할 수 있게 함.
- CloudFront는 캐시 서버를 전 세계 `엣지 로케이션`에 배치 → AWS가 가진 네트워크를 통해 AWS 리전에 기능 제공

### CloudFront의 장점

- 대용량 콘텐츠의 빠른 배포
- 보안 향상
    - 자동으로 SSL/TLS 암호화 수행
    - 무료 DDos 보호 서비스
- 가용성 향상

### CloudFront 설정

CloudFront 관리 콘솔에서 사용할 수 있는 기능

- **‘일반’ 설정**
    - CloudFront에서는 원본 서버에 배치된 파일에 대한 정보를 `배포(Distribution)`라는 단위로 취급
    - 하나의 배포에 하나의 CloudFront 도메인 할당
    - **‘일반’** 설정 : 액세스 로그 출력 설정을 비롯한 배포의 기본적인 설정
    - 안정적인 서비스 제공 : AWS WAF를 설정하면 사용자가 보내는 모든 요청이 CloudFront의 엣지 로케이션에 도달하기 전에 AWS WAF가 보안 규칙에 따라 걸러짐.
- **‘원본’ 설정**
    - 콘텐츠의 원래 데이터가 저장되는 원본이 되는 자원에 대해 설정
    - 도메인 단위로 설정할 수 있으며 AWS 자원은 S3나 ELB 등을 대상으로 가능
    - 자신이 관리하는 도메인 지정도 가능
- **‘기타’ 설정**
    - 성능 개선 및 가용성 향상
    - 오류 페이지 + 동작 설정 ⇒ 특정 에러 메시지 표시 설정 가능

### CloudFront 이용료

- 종량 과금제
- 일정량 무료로 이용 가능

## 📌 다양한 네트워크 기능을 제공하는 서비스 7가지

### AWS와 연결하는 다양한 방법

- AWS는 기본적으로 인터넷으로 접속하지만 용도에 따라 온프레미스 환경이나 사무실 환경과 직접 접속해야 하는 경우도 있음 → 네트워크의 안정성이 필요
- 이 장에서 할 것 : AWS 접속 방법 정리하고 각 서비스 상세 내용 설명

### 전용선 및 VPN

- 온프레미스 환경과 AWS에서 생성한 VPC를 연결하는 경우 → `전용선`이나 `VPN` 사용 가능
- 전용선
    - 거점 간 물리적으로 연결된 전용의 통신 회선
    - 장점 : 회선 소유자만이 통신 가능 → 안전하고 속도가 빠름
    - 단점 : 구축을 위한 비용이 많이 듦
- VPN
    - 인터넷을 가상으로 전용선처럼 취급하는 기술
    - 통신 기기 간 암호화 수행 & 경로 제어 → 각 거점을 전용선으로 연결하는 것처럼 통신 가능
    - 종류 : `사이트 간 VPN(Site to Site VPN-거점간 VPN)` / `원격 VPN(Remote VPN)`
    - 장점 : 비교적 저렴하다
    - 단점 : 물리적 경로는 공용 인터넷이므로 통신량 증가에 따른 회선 부족의 영향이 있을 수 있음

### AWS Direct Connect

- AWS Direct Connect : AWS와 온프레미스 환경 사이에 전용선을 만드는 서비스 (DX 라고도 함)
- AWS 데이터 센터의 위치는 비공개이므로 AWS가 지정하는 연결 거점까지의 전용선을 사용자가 준비 → AWS는 연결 거점부터 사용자의 계정 환경까지 통신 연결
- 이용 방법 2가지
    - 사용자가 직접 통신 사업자와 연결해 전용선 설치
    - AWS 파트너사를 통한 이용 (전용선 포함해 대부분 설정 대행)

### AWS VPN

- AWS Site-to-Site VPN
    - 목적 : 거점별 AWS와 VPN을 연결하고자 하는 경우
    - 두 사이트를 연결하는 VPN을 구성하기 위한 서비스
    - Direct Connect와 함께 이용 가능
- AWS Client VPN
    - 목적 : 특정 단말만 일시적으로 VPN을 연결하고자 하는 경우
    - 원격 VPN을 이용해 AWS에 연결하는 서비스
    - 인터넷 환경에 따라 통신 속도 저하 가능
    - Direct Connect에 비해 저렴
- 둘 다 온프레미스 환경에서 AWS와 가상 전용선을 구축해 통신하는 서비스

### AWS Transit Gateway

- `AWS Transit Gateway` : VPC 연결을 통합하는 서비스
- VPC 간 통신을 더욱 깔끔하게 정리 가능
- 장점 : 한 곳에서 접속 관리 가능 → 전체 구성 파악하기 쉽고 운영이 쉬움
- 단점 : 비용이 높음

### AWS PrivateLink

- `AWS PrivateLink` : VPC 엔드포인트 생성 서비스
- 인터넷을 통하지 않고 내부적으로 다른 VPC와 통신 가능
- VPC 피어링과 다르게 접속 제어와 같은 설정도 가능
- 인터넷을 경유하지 않고 VPC 내의 특정 인스턴스만 통신하도록 설정하는 경우 유용

### Amazon API Gateway

- `Amazon API Gateway` : 웹 API 생성 서비스
- 데이터 처리 프로그램만 구현해도 API 서비스 제공
- 인증 기능도 준비 / 에러 발생률이나 처리 시간 관리 가능

### AWS Global Accelerator

- `AWS Global Accelerator` : 전 세계에 퍼져 있는 AWS 네트워크망을 이용해 클라이언트가 AWS에 더 빠르게 접근할 수 있게 하는 서비스
- 언제 어디에서나 빠르게 네트워크 이용 가능
- Global Accelerator를 이용하면 고정 IP 주소 발급 → 글로벌 트래픽 관리 간소화

### AWS Ground Station

- `AWS Ground Station` : 인공위성 이용 예약과 AWS가 소유한 기지국과의 통신을 할 수 있게 됨 ㄷㄷㄷ
- 간단하게 이용할 수는 없음
