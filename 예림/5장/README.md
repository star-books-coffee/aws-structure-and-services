# Chapter 5. 네트워크 및 콘텐츠 전송 서비스
## 📌 네트워크 중요 용어 익히기

### IP 주소(Address)는 네트워크의 번지(주소)

- 웹 서버의 위치 : 데이터 센터 or 클라우드 서비스
- 웹 서버에 접근하기 위해서는 웹 서버가 그곳에 있다는 특정 정보 필요 → `IP 주소`
- 표준 : IPv4
    - 4개의 숫자를 점으로 구분해 표시

> 요즘은 인터넷에 접속 기기 증가 → IPv6 주목 받고 있음. BUT 보편적으로 보급되지는 않아서 여기선 IPv4 기준으로 설명
> 

### 퍼블릭 IP 주소와 프라이빗 IP 주소

- `퍼블릭 IP 주소` vs `프라이빗 IP 주소`
    - 퍼블릭 IP 주소 : 전 세계에서 식별 가능
    - 프라이빗 IP 주소 : LAN 내에서만 식별 가능
- 프라이빗 IP 주소로 사용할 수 있는 범위가 정해져 있고, 나머지는 퍼블릭 IP 주소

### CIDR 블록으로 IP 주소 범위 결정

- `CIDR` : IP 주소를 이용해 네트워크 범위를 정의하는 것
- IP 주소를 나타내는 숫자열은 크게 `네트워크` 부분과 `호스트` 부분으로 나눌 수 있음.
- 다음은 Amazon VPC의 기본 VPC의 CIDR 블록
    
    ```json
    172.31.0.0 /16
    
    2진수 표기 : 10101100 . 00011111 . 00000000 . 00000000
    서브넷 마스크 11111111 . 11111111 . 00000000 . 00000000
    ```
    
    - IP 주소 다음에 /와 숫자로 네트워크 범위를 표기한다.
    - ⭐️ `/16` : 서브넷 마스크라고 하며 IP 주소를 사용해 네트워크 범위를 정의한다면 보통 이 표기를 사용. (10진수로 표기)
        - `/16`이면 상위 16비트가 네트워크 부분임. 2진수 표기로 왼쪽에서 16번째까지 1로 표기된 부분
    - `0` : 첫 번째 0이 호스트에 해당. /16의 경우 하위 /16비트가 해당. 이 경우 사용할 수 있는 주소는 2^16개

### 방화벽에서 허용된 통신만 통과

- `방화벽` : 보안 휘협으로부터 시스템을 지키기 위해 사용하는 것
- 종류 : 하드웨어 형태의 방화벽 / 소프트웨어 형태로 서버에 설치돼 동작하는 방화벽
    - ex) 윈도우 PC ‘보안센터’ 설정 → 방화벽 설치되어 있음
- AWS에서는 보안그룹이나 네트워크 ACL

### 부하 분산을 위해 여러 서버에 접속을 분배

- 많은 사용자가 사용하는 시스템 → `부하 분산` 고려 필요
- `로드 밸런서` : 서버를 여러 대 구성해 각 서버가 처리를 나눠서 할 수 있게 구축하는 장치

### 라우팅 및 라우팅 테이블

- `라우터`가 최적의 경로를 찾아서 경로를 결정하고 연결해줌.
- 라우팅 : 라우터가 원하는 IP 주소를 향한 경로를 결정하는 것
- 어떻게 라우팅하는 게 효율이 좋을지 결정해야 함.
- 각 라우터는 소유한 경로 정보를 기반으로 목적지 IP 주소를 향해 이동해야 하는 네트워크를 결정하는데, 이 경로 정보를 `라우팅 테이블`이라고 함.
    
    ⇒ 라우터가 소유한 네트워크 지도
    
- AWS에서는 Amazon VPC의 라우팅 테이블이라는 기능이 이에 해당
    - 각 AWS 서비스에 대해 어떤 엔드포인트를 경유할지와 같은 경로 정보 관리 가능

### 도메인 이름과 IP 주소를 연결하는 DNS

- `도메인` : [OO.com](http://OO.com) 과 같이 해당 문자열에 표시되는 기업, 단체 등이 제공하는 사이트 주소를 정의
    - 점으로 연결된 문자열로 구성돼 있으며 기업 이름과 단체 이름을 표현하는 경우가 많음.
- 도메인 이름에는 IP 주소가 연결되어 있어 도메인 이름으로만으로 접속 가능
- `DNS` : 우리 대신 도메인 이름에 연결된 IP 주소를 찾아줌. 이러한 DNS의 기능을 `이름 해석`이라 함.

## 📌 VPC에서 VPC, 외부 서비스, 온프레미스와의 연결

### VPC와 외부 네트워크 연결

- 다른 VPC나 VPC 외 다른 AWS 서비스와 연결하는 기능을 소개한다.
- `VPC 피어링` : 서로 다른 VPC를 연결해 통신 가능
    - 주의 : 서로 연결된 VPC의 CIDR 블록은 겹치면 안됨.
- `AWS Transit Gateway` : VPC 연결을 하나의 중앙 허브에서 관리 가능
    - 주의 : 요금이 VPC 피어링보다 높음
    - 추천 : 많은 VPC 사용할 때

### VPC와 VPC 외 AWS 서비스를 연결

- S3 등 외부에서 동작하는 AWS 서비스는 보통 인터넷으로 통신
- BUT `VPC 엔드포인트`를 이용하면 프라이빗 네트워트로 통신 가능
    - 인터넷을 통하지 않고 AWS 내부 네트워크를 통해 연결 가능
- VPC 엔드포인트를 설정한 VPC는 S3 와 같은 다른 AWS 서비스에 직접 접근 가능
- `게이트웨이 엔드포인트` : S3나 Dynamo DB에서 사용하는 VPC 엔드포인트
    - AWS 서비스와의 통신은 퍼블릭 IP 사용
    - S3와 Dynamo DB만 지원
- `인터페이스 엔드포인트` : `AWS PrivateLink` 기능을 사용해 서브넷에 서비스 접속용 ENI(네트워크 인터페이스)를 생성해 프라이빗 IP로 통신
    - 많은 AWS 지원

### VPC와 온프레미스 네트워크 연결

- VPC는 온프레미스 네트워크와도 연결 가능
- 연결 방법 몇 가지를 소개한다.
- `AWS Site-to-Site VPN`
    - 온프레미스 환경의 네트워크와 VPC를 VPN으로 연결하는 기능
    - VPN : Virtual Private Network → 가상으로 프라이빗 네트워크 구성해 통신하는 기술
        - VPN에 접속하면 외부 네트워크와 프라이빗 IP주소로 통신 가능
    - 프라이빗 접속 방법 : 온프레미스 환경에 있는 라우터 기기에 AWS 접속을 위한 설정을 하고 AWS에도 접속 설정
    - 프라이빗이라고는 하지만 인터넷을 통해 통신이 이루어짐. IPsec VPN이라는 기술을 사용해 인터넷에 가상으로 전용 네트워크를 만드는 형태
- `AWS Client VPN`
    - 온프레미스 환경이 아니라 특정 단말과 비공개로 연결하고 싶은 경우 사용
- `AWS Direct Connect`
    - AWS와 온프레미스 환경을 전용선으로 연결
    - AWS 데이터 센터와 직접 연결하응 게 아니라 Direct Connect 로케이션이라는 기존 연결 지점을 통해 연결
    - VPN 연결과 비교 : 고품질 네트워크 사용 가능 / 이용비용이 높음 / 서비스 이용 준비 기간이 길다
 
## 📌 간편하게 사용할 수 있는 DNS 서비스

### Route 53

- `Route 53` : AWS가 제공하는 DNS 서비스
    - 완전 관리형 → 유지 및 관리 작업 필요 X
    - 글로벌 서비스 → 모든 리전에서 공통으로 사용 가능
- 관리 : `호스팅 영역` 별로 수행
    - 호스팅 존 : 도메인과 해당 하위 도메인의 트래픽 라우팅 방법에 대한 정보를 보관하는 상자
    - 등록한 각 도메인에 대해 호스팅 영역이
    만들어지고 다양한 설정이 관리된다
- 특징
    1. 높은 가용성
    2. 높은 비용 성능

### Route 53 기능

크게 세 가지 기능

- 도메인 등록 기능
- 도메인 트래픽 라우팅
- 자원에 대한 상태 확인

### 도메인 등록 기능

- 임의의 호스팅 영역 생성해 도메인 등록 가능
- 임의의 도메인 이름을 Route 53에서 `DNS 레코드`로 등록 가능
- DNS 레코드 : DNS가 관리하는 도메인과 어떤 IP 주소, 정보가 연결돼 있는지를 기록한 데이터
    - DNS는 이 DNS 레코드를 기반으로 질의한 곳에 도메인에 해당하는 IP 주소를 반환
- DNS 레코드 종류
    - A : Ipv4 주소에 대한 레코드
    - AAAA : Ipv6 주소에 대한 레코드
    - CNAME : 특정 호스트 이름에 대한 별칭을 정의하는 레코드
    - NS : 호스팅 영역의 네임서버 이름 정의하는 레코드

### 도메인으로 트래픽 라우팅

- 생성한 DNS 레코드 별로 `라우팅 정책` 설정 가능
    - 여기서의 라우팅 : 라우터의 라우팅과 다르게 도메인 이름에 대한 IP 주소를 어떻게 반환하는지를 의미
- 단순 라우팅
    - 일반적으로 DNS와 같은 라우팅을 수행
        
        ⇒ 하나의 도메인에 대해 하나의 IP 주소만 연결
        
- 가중차 기반 라우팅
    - 라우팅 대상을 여러 개 등록하고 각각에 트래픽을 할당하는 정도를 0에서 255 사이의 값(가중치)으로 지정
    - 가중치에 따라 어느 IP 주소를 반환하는지 결정
- 지리적 위치 라우팅
    - 조회한 곳의 위치 정보에 따라 어떤 IP 주소를 반환할지를 결정
- 지연 시간 라우팅
    - 항상 레이턴시(데이터 처리 지연시간)가 최소인 자원의 IP주소를 우선적으로 반환
- 장애 조치 라우팅
- 다중값 응답 라우팅

### 자원 상태 확인

- `상태 확인 기능` : 대상이 정상적으로 실행 중인지 확인
- 대상이 정상인지 판단하는 기준 : 라우팅하는 곳에서 반환되는 응답 결과 확인하기
    - 엔드 포인트
    - 다른 상태 확인의 상태(산출된 상태 확인)
    - CloudWatch 알람 상태
- 상태 확인 결과를 바탕으로 자동 라우팅 변경 & 알람과 같은 동작을 추가해 서비스가 안정적으로 실행될 수 있게 함.
- 상태 확인 요금 있음.
