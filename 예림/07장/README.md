# Chapter 7. 보안 관련 서비스
## 📌 AWS를 시작하기 위한 첫 걸음

### 정보 보안 3대 요소

- 정보보안의 3대 요소 : 기밀성, 무결성, 가용성
- 기밀성 : 정보가 유출되지 않도록 관리
- 무결성 : 정보가 손상되거나 손실되지 않고 최신의 상태인 것
- 가용성 : 정보를 언제나 사용할 수 있게 하는 것

### 다양한 서비스를 결합해 정보를 보호하는 AWS

- IAM이라는 서비스에서 인증, 인가 관리 가능

## 📌 AWS를 안전하게 사용하기 위한 IAM

### AWS Identity and Access Management란

- IAM : AWS를 사용하는 계정의 권한을 관리하는 서비스
- **AWS 서비스의 조작 제어는 모두 IAM으로 관리**

### IAM 사용자, IAM 그룹

- 사용자가 AWS를 조작하기 위해 사용하는 것이 `IAM 사용자`
- 비밀번호 등의 인증 정보를 사용해 로그인(인증) → IAM 사용자에게 할당된 권한을 사용(인가)
- `액세스 키`라는 인증 정보 발행
- `IAM 그룹`을 만들어 그룹에 권한을 설정
    - 해당 그룹에 IAM 사용자를 추가하면 IAM 사용자는 해당 그룹에 설정된 권한 사용 가능
    - 여러 사용자가 동일한 권한을 갖도록 관리해야 할 때 유용

### IAM 정책

- 어떤 서비스의 기능에 어떤 조작을 할 수 있는지와 같은 권한은 `IAM 정책`을 통해 설정 가능
- 권한 설정을 묶어 이름을 붙여 정의 가능 → 재사용 가능
- 단일 IAM 사용자, IAM 그룹이나 IAM 역할에 여러 IAM 정책 연결 가능
- AWS 관리형 정책 제공 : 서비스나 기능능이 추가될 때 자동으로 관련 권한 추가
    - ‘모든 서비스 이용 가능’
    - ‘모든 서비스 참조만 가능’
    - ‘S3의 모든 기능 사용 가능’
    - 등등
- 보다 강력한 정책을 원할 때 → `고객 관리형 정책`
    - 사용자가 직접 만든 IAM 정책

### IAM 역할

- IAM 사용자를 생성할 때 액세스 키도 함께 생성
- `액세스 키` : CLI로 AWS 자원을 조작하거나 프로그램을 통한 제어를 할 때 사용하는 인증 정보
    - ex) Lambda에서 EC2를 실행하는 조작을 해야 할 때 : Lambda 프로그램에서 액세스 키를 이용해 AWS 계정의 권한을 위임 받아 EC2 실행
- 액세스키는 고정 문자열이며, AWS 계정과 동일한 권한을 가지고 있음 → 보안 위협
- AWS 서비스에 권한을 부여할 때는 `IAM 역할`을 사용하는 것이 좋음
    - 조직의 AWS 리소스에 대한 권한이 없는 사용자나 서비스에 액세스 권한 위임 가능
    - 사용자에게 권한을 부여하는 게 아니라 ‘서비스’에 해당 서비스를 사용할 수 있는 ‘사용자’를 지정
- AWS 권장 사항 : 구축하는 시스템별로 AWS 계정 분리할 것을 권장
- `Role Switch(역할 변경)` : 각 AWS 계정에 사용자 역할 별 IAM 역할만 생성하고 IAM 사용자가 필요한 때만 역할을 부여해 적절한 권한으로 작업할 수 있게 설정 가능
    - IAM 사용자 자체에는 조작 권한을 부여하지 않고 부여된 IAM 역할이 가진 권한으로 각 계정 조작

## 📌 계정 내 작업 이력 기록

### AWS CloudTrail이란

- AWS Cloud Trail : AWS 계정을 만들 때부터 자동으로 모든 작업을 기록하는 서비스
- 필요성 : 악의적인 조작 파악 및 프로그램 문제로 발생한 설정 변경 등 조사 가능
- 로그 저장 가능 : 로그는 기본적으로 90일동안 저장되지만 그 이상 보관하고 싶은 경우 S3와 같은 별도의 스토리지에 파일로 저장 가능
- `트레일(Trail)` : S3에 저장하는 로그 파일
    - 암호화되어 보관됨
- 로그 변조를 막는 기능도 있음

### 기록되는 내용

- CloudTrail에 저장되는 내용 : 관리 콘솔과 API를 통한 조작 이력
    - 이에 해당되지 않는 조작은 기록되지 않음(ex. 원격 EC2 접속)
- 조작 내용 3가지
    1. 관리 이벤트
        
        관리 콘솔에 로그인, AWS 자원의 생성, 수정, 삭제
        
    2. 데이터 이벤트
        
        S3 버킷 관련 작업, Lambda 함수 실행과 같은 AWS 자원에 대한 조작
        
    3. 인사이트 이벤트
        
        AWS 계정의 행동 탐지(평소와는 다른 조작) (평소 사용 패턴을 학습하고 거기에서 벗어난 조작 패턴 탐지)
        
- 기본으로 (1) 관리 이벤트만 기록하게 설정되어 있고 이외에는 설정 필요 (비용 발생)

### 트레일 출력

- Cloud Trail에는 90일 간의 관리 이벤트만 저장 가능
    - 그 이상을 저장하고 싶다면 S3나 Cloud Watch Log 이용
    - 저장 비용 발생하지만 로그 무기한 저장 가능
- 로그를 추적(trail)해 S3나 CloudWatch Logs로 출력 가능
- S3에 저장하는 경우 : 파일 형태로 저장
    - 파일의 무결성 검사 파일(다이제스트 파일)도 출력 가능
- CloudWatch Logs에 저장 : ‘스트림’ 형태로 저장
    - 스트림 : 로그의 내용이 순차적으로 저장
    - 특정 조작이 발생했을 때 사용자에게 알림 보내기 가능
 
## 📌 설정 내역 및 설정 내용을 자동으로 관리

### 설정 이력을 저장하는 AWS Config

- AWS 자원에 대한 구성 정보와 변경 이력을 남기는 서비스
- 기본적으로 7년치 정보 저장
- CloudTrail과 다르게 AWS 자원의 설정 내용을 기반으로 이력 저장
- 고급 쿼리라는 기능을 이용해 특정 자원 수 확인 가능

### 설정을 확인하는 AWS Config 규칙

- 각 설정이 규칙을 준수하는지 확인 가능
- 규칙 미준수 자원을 발견하면 메일로 알림 발송
- 자동 수정도 가능
