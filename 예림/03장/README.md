# Chapter 3. 컴퓨팅 서비스
## 📌 알아둬야 할 서버 기초 지식

### 대표적인 서버 유형

**웹 서버**

- 웹 사이트를 구성하는 데 필요한 데이터를 저장하고 시스템을 제어하는 프로그램을 설치한 서버
- 웹 서버에는 웹 페이지 자체의 구조를 만드는 HTML 파일과 디자인을 정의하는 CSS 파일, 사이트에 표시되는 이미지 파일 등 서비스 제공에 필요한 데이터가 저장됨.

> 웹 브라우저 = 클라이언트 
웹 사이트 = 웹 서버
> 

**데이터베이스 서버**

- 시스템이 취급하는 데이터를 통합 관리하는 데이터베이스 관리 시스템이 설치된 서버
- 클라이언트에서 특정 데이터를 참조하거나 수정, 삭제 등의 데이터 처리 요구를 요청으로 받아들이고 실행 결과를 응답으로 반환
- EC2에 데이터베이스 관리시스템을 설치해 DB 서버를 설치해 DB 서버를 구축할 수 있지만, AWS 관리형 서비스이면서 튜닝이 쉬운 RDS나 DynomoDB 서비스 중에 선택해 이용할 수 있다.

**메일 서버**

- SMTP 프로토콜, POP3 프로토콜을 이용해 메일 송신, 전달, 수신하는 서버
- 역할에 따라 SMTP 서버와 POP3 서버로 나뉜다.
- SMTP 서버가 시스템에서 자주 사용되므로 이 책에서는 SMTP에 대해 설명한다.
- SMTP 서버 : 메일을 보내는 역할을 하는 서버
- 메일을 보내는 과정
    1. 메일 보내는 사람이 메일 클라이언트 프로그램에서 메일을 작성
    2. SMTP 서버에 메일 전송 요청
    3. 요청을 받은 SMTP 서버가 수신처를 DNS 서버에서 확인해 어디로 메일을 보내야할지 특정
    4. 해당 메일 주소로 메일 전송
- AWS에서는 EC2에 사용자가 메일 서버 구축 가능
    - AWS 관리형 메일 전송 서비스인 Amazon SES 이용

### 웹 서버 작동 방식

- 클라이언트 - 서버 통신 / HTTP 또는 HTTPS 프로토콜로 데이터 주고 받음.
- 웹 서버가 취급하는 데이터
    - 웹 사이트의 콘텐츠 구성을 정의하는 HTML을 중심으로 사이트 자체의 디자인이나 웹 페이지에서 실행되는 프로그램은 서버에 저장되어 있음.
    
    | 카테고리 | 데이터 | 설명 |
    | --- | --- | --- |
    | 사이트 구성 | HTML |  |
    | 사이트 레이아웃 및 디자인 | CSS |  |
    | 스크립트(서버) | PHP, Ruby 등 | 웹 서버에서 처리하는 프로그램, 요청에 따라 처리 결과를 클라이언트에 반환 / 항상 웹 서버에서 처리되므로 결과는 클라이언트 환경에 의존하지 않음. |
    | 스크립트(클라이언트) | JavaScript | 클라이언트(브라우저)에서 실행되는 프로그램 / 클라이언트가 처리하기 때문에 서버에 부하를 주지 않는다. |
    | 이미지 | JPEG, GIF, PNG 등 |  |

### 서버 OS란

- 서버로 이용되는 기기는 주로 `리눅스`나 `윈도우 서버`가 이용된다.

**리눅스**

- 무료 / 오픈소스 소프트웨어 → 누구나 자유롭게 개발, 베포 가능
- 다양한 기업과 단체가 독자적으로 개발한 OS를 `리눅스 배포판(Distribution)`으로 제공하고 있음.
- 대표적인 리눅스 배포판
    
    
    | 배포판 이름 | 설명 |
    | --- | --- |
    | Ret Hat Enterprise Linux | 대규모 시스템 등의 서버에서 많이 이용 / 패키지 관리 시스템으로 RPM 이용 |
    | CentOS | RHEL의 복제 OS / RHEL의 사용 부분을 제거한 배포판 |
    | Debian GNU / Linux | 패키지 관리 시스템으로 deb 이용 |
    | Ubuntu Linux | Debian 기반으로 만들어진 배포판 / 주로 개인 용도로 많이 사용 |

**윈도우 서버**

- 마이크로소프트에서 출시한 서버용 OS
- 리눅스와 달리 OS 자체의 라이선스와 CAL로 불리는 서버 이용 라이선스를 구매해야 함.
- 특징
    - ⭐️ GUI로 조작하며 일반적으로 사용되는 데스크톱 윈도우와 사용법이 비슷함.
        
        ⇒ CUI로 조작하는 리눅스 배포판에 비해 사용이 편함.
        
    - 다른 마이크로소프트 제품과의 연계성 굿
    - AD(Active Directory)와의 연계, 충실한 지원 등

### 서버 가상화

일반적으로 1대의 기기는 1개의 OS만 설치되지만 가상화 소프트웨어를 이용하면 하나의 하드웨어에 여러 OS 동작 가능 ⇒ `서버의 가상화`

> **비유하기**
> 
> - 물리 서버 = 단독 주택
> - 가상 서버 = 아파트
> - 하드웨어 = 건물
> - OS = 가족
- 단독 주택의 경우 그 건물에 사는 가족이 한 가족 뿐임.
- 아파트는 건물 내 여러 집이 존재하고 한 집에는 한 가족이 살 수 있으므로 한 건물에 여러 가족이 살 수 있음.
- 가상 서버는 하나의 하드웨어에서 여러 OS 이용 가능
    - 하드웨어 안에서 방을 나눠 방마다 OS 가동
- 가상화를 수행하는 서버는 가족별로 방의 크기=CPU나 메모리 같은 컴퓨팅 자원의 규모를 결정해야 함. 실제 서버의 경우 OS 종류와 실행할 소프트웨어에 맞춰 자원 할당을 고려해야 함.
- 전체적으로 얼마나 가족이 살수 있는지는 건물의 크기(실제 하드웨어 자원)에 따라 결정

### AWS에서의 가상화

Amazon Elastic Computer Cloud(EC2)

## 📌 EC2 가상 서버를 손쉽게 생성

### EC2란

- 온프레미스랑 무엇이 다를까?
    - 온프레미스 : 하드웨어부터 OS 설치까지 사용자가 해야 함.
    - EC2 :
        - 가상머신을 생성할 때 OS도 함께 설치
        - CPU나 메모리 같은 서버의 사양도 자유롭게 선택 가능
        - 스토리지 용량 변경 가능
        
        ⇒ 부담 없이 서버 생성해 테스트 가능
        
- EC2는 가상서버를 `인스턴스` 단위로 관리한다.
    - 인스턴스 유형 == 가상 서버 사양

### 가상 서버 생성

- 설정해야 하는 것
    - AMI (Amazon 머신 이미지)
    - 인스턴스 사양(인스턴스 유형)
    - 배포할 네트워크
    - 데이터를 저장할 스토리지 용량
    - 사용 권한 설정(보안 그룹)
- 순서
    1. `AMI` 설정 : OS와 소프트웨어가 설정된 템플릿
    2. `인스턴스 유형` 설정 : 가상서버의 성능 결정 
    3. `네트워크` 설정 : 사용자가 생성한 VPC를 선택
    4. `EBS` 설정 : 스토리지 용량(EBS) 설정
    5. `보안그룹` 선택
- 인스턴스 연결하는 방법
    - 리눅스 → SSH / 윈도우 → 원격 데스크톱 등 관리 시스템
    - AWS Systems manager 사용 : EC2 인스턴스를 관리하는 서비스

### 인스턴스 유형으로 서버 성능 결정

- 인스턴스 유형 이름 규칙

- ex) m6g.medium
    - m (`패밀리`): 메모리와 CPU 중 어느 것을 우선시 하느냐와 같이 인스턴스의 특징에 따른 문자열
        - T 유형 인스턴스의 경우, 베이스라인(Baseline)이라는 정해진 CPU 사용률이 정의돼 있으며 정의된 사용률을 초과해서(버스트) 이용할 수도 있다.
        - 다만 일정량을 넘으면 베이스라인 이하의 성능이 되거나 추가 요금 발생
        - 서비스 환경과 같이 상시 사용이 예상되는 환경에서는 M 유형 추천
    - 6 (`세대`) : 숫자가 클수록 성능이 좋다.
    - g (`추가 기능`) : Graviton2(CPU 이름)은 g, 네트워크 강화는 n. 추가기능 문자가 없는 유형도 있음.
    - medium (`크기`) : 크기가 클수록 고성능. 가격도 크기에 따라 높아진다.

### 다양한 EC2 요금제

- 온디맨트 인스턴스 : 일반적으로 사용하는 EC2 인스턴스
- 예약 인스턴스 : 1년 또는 3년간 요금을 선불로 지불하고 이용 (온디맨드 같은 기간동안 이용할 경우보다 최대 72% 할인!!!)
- 절감형 플랜 : 예약 인스턴스와 마찬가지로 기간 약정 조건이지만 다양한 서비스를 운영할 때 유리
    - 여러 패밀리와 크기를 할당해 구매할 수 있음.
- 스팟 인스턴스 : AWS에서 이용하지 않는 자원을 활용해 인스턴스 생성 (최대 90% 할인)
    - AWS 측에서 정지할 수도 있으므로 정지가 허용되는 곳에서 활용 가능

### 그 밖의 EC2 관련 요금

- 네트워크 외부로의 데이터 통신, 데이터를 저장하는 스토리지(EBS)에서 자잘한 요금 발생

- EC2는 AWS의 대규모 서버에서 가상화를 수행
- 사용자는 사용 용도에 따라 OS의 종류나 CPU, 메모리 크기를 자유롭게 선택해 `인스턴스`(가상 서버)를 생성할 수 있음.

> AWS가 보유한 대규모 서버에 여러 사용자의 EC2 인스턴스가 함께 존재한다.

## 📌 가상 서버를 안전하게 외부에 공개

### 서버 외부 공개

EC2를 인터넷에 공개하려면 다음 3가지 조건을 충족해야 한다. 

- EC2를 퍼블릭 서브넷에 배치
- 퍼블릭 IP 주소를 EC2에 부여
- 보안그룹에서 외부로부터의 접근을 허가

### 서버 접근 제어

어느 곳에서 어느 곳으로 접속을 허가할지에 대한 접근제어는 `보안그룹`을 이용한다. 

보안그룹은 온프레미스의 `방화벽` 기능을 수행한다.

- 외부에서 EC2로의 통신을 인바운드 규칙으로 정의하고
- EC2에서 외부로의 통신을 아웃바운드 규칙으로 정의하며
- 둘 다 통신을 허용할 네트워크와 포트 번호를 지정한다.

> 인바운드 규칙의 ‘소스’는 출발지를 의미.
> 

> 아웃바운드 규칙의 기본 설정은 외부로의 모든 트래픽(통신) 허용
> 
- **보안 그룹에 규칙을 추가할 때 대상에 IP가 아니라 보안 그룹 지정도 가능**
    - EC2-A 인스턴스와 EC2-B 인스턴스가 있고, EC2-A에서 EC2-B로 통신을 허가해야 하는 경우 EC2-B 보안그룹에 EC2-A 보안그룹 ID를 지정하면 EC2-A의 IP가 지정돼 통신이 허가 된다.
    - EC2의 IP를 직접 입력하는 것보다 안전하다. 그룹 ID는 변경되지 않기 때문이다.
- 보안 그룹의 특징
    - 보안그룹에 지정하는 규칙은 허용만 할 수 있다는 특징이 있다.
    - 특정 네트워크로부터의 통신을 차단하도록 설정할 수는 없다.
- 주의할 점
    - 보안그룹은 용도마다 따로 생성하고 키-값에 별칭을 잘 입력해 실수하는 일이 없게 하는 것이 좋음.
    - 불필요한 보안그룹은 바로 삭제해야함.
