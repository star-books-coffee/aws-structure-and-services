## 📌 Amazon S3는 데이터 저장 장소

### 객체 스토리지

- `S3` : AWS에서 제공하는 객체 스토리지 서비스
    - `스토리지` : 데이터를 저장하는 장소
    - `객체` : 텍스트 파일이나 음성 파일 같은 데이터를 말함.
- `객체 스토리지` : 기존의 파일 스토리지처럼 폴더 구조는 갖지 않고 객체 키로 데이터를 고유하게 식별해 데이터의 입출력과 관리를 수행
    - 키만으로 데이터 관리 → 간편하게 대용량의 데이터 저장 및 관리 가능

### S3의 특징

- 용량 무제한
    - 객체당 5TB
    - 객체 수나 데이터 용량에는 제한 x
- 높은 내구성
    - 일반적으로 데이터가 3개 이상의 AZ로 복사
- 저렴한 비용
    - 서울 리전의 표준 스토리지는 요금이 1개월당 0.025USD/GB
    - 스토리지 클래스 변경을 통해 더욱 저렴한 요금으로 데이터 저장 가능

### 다른 서비스와 연계

- 다른 서비스와 연계해 사용하는 경우가 많음.
    - ex) Amazon VPC라는 네트워크 서비스의 로그(VPC 흐름 로그)나 콘텐츠 전송 네트워크(CDN) 서비스인 Amazon CloudFront 접속 로그를 S3에 저장
    - ex) EC2의 스토리지인 EBS의 스냅숏을 저장하기 위해 사용
    - ex) 기계 학습 서비스의 입력 정보 저장

### 요금

- 데이터 저장 용량, 데이터 엑세스 횟수, 데이터 전송량에 따라 요금 발생

## 📌 S3의 기본 용어 및 기본 조작

### S3에서 사용되는 중요 용어

- 버킷
    - 객체(데이터)를 저장하는 장소
    - 버킷의 이름은 고유해야 함.
- 객체
    - 버킷에 저장된 데이터 본체
    - 버킷에는 객체를 무제한 저장 가능 BUT 한 객체의 최대 크기는 5TB를 넘을 수 없음.
- 키
    - **객체의 저장 URL 경로**
    - 버킷 이름과 키 이름, 객체 이름으로 객체 데이터의 위치를 나타냄.

```jsx
s3://test-bucket/folder/object.txt
// test-bucket : 버킷 이름
// folder/object.txt : 키 이름
// object.txt : 객체 이름
```

> S3는 객체 스토리지로 실제로는 폴더 구조가 아니지만 ‘/’이라는 문자열을 구분자로 판단해 관리 콘솔에서는 폴더 구조처럼 객체가 표시된다.
> 

### S3의 데이터를 브라우저나 프로그램에서 조작

- S3는 데이터를 등록하거나 삭제하는 API를 제공하므로 이를 호출해 S3의 객체 조작 가능

| GET | S3에서 데이터(객체)를 다운로드 |
| --- | --- |
| PUT | S3에 객체를 업로드, 신규 업로드, 갱신(덮어쓰기) / 하나의 PUT 작업은 최대 5GB까지이므로 많은 데이터를 업로드 하는 경우 멀티 파트 업로드 기능 이용 |
| LIST | S3 버킷의 객체 목록 표시, 데이터 추출도 가능 |
| COPY | S3 내에서 객체를 복사. 다른 버킷과 리전 간에 복사 가능 |
| DELETE | S3 내에 있는 임의의 객체를 삭제 |


## 📌 S3 데이터를 적절하게 저장

### 사용하지 않는 객체는 저렴하게 저장

- S3는 여러 `스토리지 클래스` 제공
- 비용 효율성을 중시한 아카이브용 스토리지인 `Amazon S3 Glacier`라는 스토리지 클래스도 있음.
- 여러가지 스토리지 클래스 존재
- 수명 주기 설정 기능 : 자동으로 스토리지 클래스 변경 가능
    - ex) 생성한지 1년 지난 객체는 Glacier Flexible 객체로 마이그레이션하는 설정 가능. 객체 삭제 가능
    - BUT 저비용 스토리지 클래스로 마이그레이션하면 표준 클래스로 되돌아갈 수 없음.
- 어느 스토리지 클래스를 사용해야할지 모르겠다면? `S3용 액세스 분석기`
    - 데이터 용량과 접근상태 확인한 다음 스토리지 클래스 결정하는 것도 좋은 방법

### 버전 관리 및 다른 리전으로 복사

- S3 상의 데이터는 3곳 이상으로 복사됨.
    
    ⇒ 데이터 손실 거의 없음
    
- BUT 사용자의 실수로 인한 데이터 변경 가능성 존재
- 버전관리기능 활성화 → 모든 세대의 객체에 대한 이력 정보 보존
- 객체 갱신 시(PUT)에는 기존 객체와 다른 새로운 버전 ID 부여
- 버전 관리 설정은 S3 버킷 단위로 가능 (객체 단위의 설정은 불가)
- 삭제(DELETE) 시 객체가 실제로 삭제되는 게 아니라 삭제 마커 부여
- 버전관리는 편리하지만 추가 요금 발생
    - 수명주기 설정을 이용해 과거 버전을 일정 기간이 지나면 자동 삭제하는 방식으로 운영도 가능
- `교차 리전 복제(CRR-Cross Region Replication)` : 데이터 저장 위치와 다른 리전에 데이터 복사하는 기능 ⇒ 데이터 내구성 UP
- 재해 복구(DR-Disaster Recovery) : 하나의 리전 전체가 재해를 당한 경우를 대비하는 것

## 📌 S3 데이터를 안전하게 공개

### S3 버킷에 대한 접근 제어

- 허가받은 사람이 허가받은 객체에 접근할 수 있도록 `접근 제어`하는 것이 중요
- S3 접근 제어는 다음 세 가지 방법으로 구현 가능
    1. **사용자 정책(IAM 정책)**
        
        데이터를 조작하는 쪽을 제어하는 설정 (ex. A는 버킷의 데이터 검색만 가능하고 업로드는 불가)
        
    2. **접근 제어 목록(ACL)**
        
        객체(데이터) 또는 버킷 단위로 설정할 수 있는 접근 제어 (ex. 데이터 A는 AWS 계정 X에 접근 허용)
        
    3. **버킷 설정(버킷 정책)**
        - 버킷 단위로 설정하는 접근제어 (ex. 파일 이름이 logs로 시작하는 데이터에 접근 허용 / IP 주소 XX.XX.XX.XX로부터 접근 허가)
        - 설정은 JSON 형식으로 기재
        - 가장 많이 사용
- 객체가 자칫하면 전 세계에 공개하는 퍼블릭 상태가 되므로 주의 필요
- `퍼블릭 액세스 차단` 이라는 기이 있음.

### S3를 이용해 웹 사이트 구축

- S3 버킷에 저장된 HTML / CSS / JS 등의 콘텐츠 파일을 이용해 웹 사이트 구축 가능
- `웹 사이트 호스팅 기능` 활성화 ⇒ http://버킷이름.s3-website-리전이름.amazon.com’이라는 URL이 만들어짐.
- 버킷 정책이나 객체 단위의 ACL을 이용해 특정 사용자만 콘텐츠에 접근하게 제어 가능
- S3는 암호화된 통신인 `HTTPS` 지원 X → 민감한 정보가 포함된 경우 CDN 서비스인 Amazon CloudFront를 함께 사용해 HTTPS 통신을 할 수 있게 구성

### 데이터 암호화

- 데이터 암호화 : 데이터와 키 데이터를 조합해 데이터 내용을 타인이 볼 수 없게 함.
    - 데이터 + 키 ⇒ 암호화 데이터
- 키 데이터가 있어야 데이터를 읽을 수 있음.
- S3의 기본 암호화 기능을 활성화하면 AWS에서 자동으로 암호화 수행
    - AWS Key Management Service(KMS) : AWS에서 제공하는 키 관리 기능
- 클라이언트 측 암호화 : S3에서 제공되는 기능은 객체 저장 시 암호화이므로 S3로 전송할 때 암호화하고 싶다면 미리 데이터를 응용 프로그램에서 암호화해 전송해야 함.
    - 사용자 고유의 키나 KMS 키 사용 가능
    - S3의 API에 대한 접근은 기본적으로 HTTPS에서 수행되므로 통신은 모두 암호화 됨.
 
## 📌 가상 서버 데이터 저장을 위한 EBS

### 서버 데이터를 저장하는 EBS

- Elastic Block Store(EBS) : EC2와 함께 사용하는 스토리지 서비스로 EC2의 HDD/SSD 역할을 함.
- EC2에서 실행되는 응용 프로그램의 데이터, 로그, 설정 정보 등 저장하는 데 주로 사용
- 응용 프로그램에 따라 필요한 데이터의 읽기/쓰기 속도가 다른데, 필요한 속도에 따라 볼륨 유형 선택 가능
- EBS의 쓰기/읽기 성능은 IOPS라는 초당 쓰기/읽기 횟수를 표현하는 단위 사용
- 특별히 요구되는 성능 사항이 없다면 범용 SSD 사용
- 고성능 응용프로그램의 경우 : 프로비저닝된 IOPS SSD
- 저렴이를 원하는 경우 : 처리량 최적화 HDD 또는 Cold HDD

### 서버 백업 및 이미지 관리

- `스냅숏`과 `백업` 기능 지원 : 장애 발생으로 인한 데이터 파손 및 의도치 않은 삭제 방지
- 스냅숏에는 스냅숏을 만들 당시 EBS에 보존하고 있던 모든 정보 백업
- 스냅숏과 몇 가지 설정 정보를 조합해 사용자 전용 AMI 생성 가능

### EBS 요금 예

- 용량을 확보한 순간부터 계속 요금이 발생
- EC2 중지하고 있어도 요금 계속 발생
