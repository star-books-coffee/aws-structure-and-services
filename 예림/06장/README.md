# Chapter 6. 데이터베이스 서비스
## 📌 알아둬야 할 데이터베이스 기초 지식

### 데이터의 집합체, 데이터베이스

- DB
- DBMS
- RDB
- NoSQL
    - 키와 값이라는 두 가지 요소를 조합해 키-값 형태로 관리하는 서비스

### SQL로 조작하는 관계형 데이터베이스

- SELECT : 데이터 검색
- INSERT : 데이터 추가
- UPDATE : 데이터 갱신
- DELETE : 데이터 삭제

### 데이터 불일치를 없애기 위한 ACID 특성

- 관계형 데이터베이스의 특징 중 하나 : `ACID`
    - 원자성 (`A`tomicity)
        
        트랜잭션은 모두 실행되거나 실행되지 않아야 한다
        
    - 일관성 (`C`onsistency)
        
        정해진 데이터베이스의 규칙을 만족해야 한다
        
    - 독립성 (`I`solation)
        
        트랜잭션을 단독으로 실행할 때나 동시에 여러 개를 실행할 때 결과가 같아야 한다
        
    - 지속성 (`D`urability)
        
        하드웨어 등의 장애가 있어도 완료된 트랜잭션의 결과는 손실되지 않아야 한다
        
- 데이터베이스에서 수행하는 일련의 처리 : 트랜잭션
- 이 트랜잭션의 단위가 ACID 특정을 가짐
- 예시 : 은행 계좌의 예금 인출
    
    (1) 지정한 금액을 인출
    
    (2) 예금 잔액 데이터 갱신
    
    - (1)의 처리만 되는데 처리가 중단되면 예금은 인출되지만 잔액이 변하지 않으므로 큰 문제가 됨 → (1) (2) 모두 실행하거나 어느 쪽도 실행되지 않게 해야 함.
- 이처럼 데이터나 처리의 불일치가 발생하지 않게 하기 위해 ACID 특성이 사용됨

## 📌 AWS에서 관계형 데이터베이스 사용

### 관계형 데이터베이스 서비스 RDS

- OS나 데이터베이스 엔진 관리는 AWS 측에서 수행
- 종량 과금제
- 데이터베이스 엔진 : 데이터베이스에 대한 데이터 등록, 갱신, 삭제 처리를 관리하는 소프트웨어
    - MySQL, MariaDB, …, Aurora 등
- Aurora : AWS가 클라우드용으로 구축한 DB

### 데이터베이스 성능을 결정하는 인스턴스와 스토리지 유형

- 인스턴스에 따라 성능이 달라짐
- **RDS 인스턴스 유형**
    - 인스턴스 크기를 선택해 성능 결정
    - 인스턴스 크기의 명명 규칙은 다음과 같음
        
        ```cpp
        db.m6g.large
        ```
        
        - db : 고정
        - m : 패밀리 (메모리가 우선인지 범용인지에 따라 지정하는 문자열)
        - 6 : 세대 (숫자가 클수록 새롭고 고성능)
        - 9 : 추가 기능
        - large : 크기
    - 앞의 ‘db’가 고정된 것 제외하고는 EC2와 동일한 규칙
- **스토리지 유형**
    - 데이터를 저장하는 것이 주된 목적인 만큼 스토리지 선정 매우 중요
    - 스토리지 유형
        
        
        | 볼륨 유형 | 개요 |
        | --- | --- |
        | 범용 SSD | 고성능으로 용량에 따라 읽기 / 쓰기 성능 결정 |
        | 프로비저닝 IOPS SSD | 고성능이며 지정한 읽기/쓰기 성능 확보 |
        | 마그네틱 HDD | 저렴한 비용 |

### 가용성 향상을 위한 예비 복제본과 읽기 성능 향상을 위한 읽기 전용 복제본

- 데이터를 처리하는 `프라이머리 인스턴스` 외에 `예비 복제본(Standby replica)`을 다중 AZ에 배포해 가용성 향상 가능
- 고가용성을 예비 복제본으로 구현 ⇒ `다중 AZ 배포` (중단되면 안되는 시스템은 다중 AZ에 배치)
    - `고가용성` : 시스템이 중단되지 않고 작동할 수 있는 능력
- `장애 조치(Fail Over)` : 프라이머리 인스턴스나 AZ에 장애가 발생하면 예비 복제본으로 전환해 데이터 베이스를 계속 이용할 수 있도록 하는 전환
- 프라이머리 인스턴스에 장애가 발생하면 `엔드포인트`의 목적지가 자동으로 예비 복재본으로 전환
- 읽기 전용 레플리카 기능 : 프라이머리 인스턴스에서 복제된 인스턴스로, 읽기 전용으로 사용할 수 있다
    - 읽기 처리를 읽기 전용 복제본에 분산 가능(스케일 아웃)
    - 쓰기 성능 향상 불가
- 예비 복제본은 가용성 향상이 목적이라 일반적으로 처리는 수행하지 않음 → 성능 향상에 도움이 되지는 않음

### RDS 보안 설정과 백업

- **RDS 접근 제어**
    - EC2와 마찬가지로 VPC 내에 생성되므로 최소한 두 개의 서브넷 필요
    - 접근 제어는 EC2와 마찬가지로 보안그룹과 네트워크 ACL에서 설정
    - 일반적으로 응용 프로그램에서 DB 접속하는 경우가 많기 때문에 응용 프로그램에서만 접속할수 있도록 보안 그룹이나 네트워크 ACL로 적절하게 설정해야 함
- **데이터베이스 엔진 업데이트**
    - DB 엔진이 실행되는 OS에 취약점 발생 가능
    - 정기적으로 버전 ‘업그레이드’ 필요
    - 버전 업그레이드는 AWS 측에서 실시하지만 ‘업데이트’ 작업은 `유지 관리 기간`이라는 사용자가 설정한 시간대에 실시
        - 일시적으로 RDS 인스턴스 오프라인 상태가 되므로 사용률이 높은 이용 시간대를 피해야 함
- **데이터 백업**
    - RDS는 **자동 백업 기능**이 있어 사용자가 지정한 일 수만큼 `스냅숏` 자동 유지
    - 스냅숏 취득 처리는 사용자가 지정한 백업 위ㅜㄴ도우의 시간대에 실행
    - 스냅숏 파일은 S3 파일에 저장 → 내구성 높음
    - 스냅숏은 새 RDS 인스턴스를 생성하는 방식으로 복원 가능
    - `특정 시점 복구(PITR)` : 특정 시간을 지정하고 복원 가능(특정 시간으로 되돌리는 용도)
